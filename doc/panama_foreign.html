<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>Using Panama &quot;foreign&quot; JDK</title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
  </style>
  <link rel="stylesheet" href="../make/data/docs-resources/resources/jdk-default.css">
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header>
<h1 class="title">Using Panama &quot;foreign&quot; JDK</h1>
</header>
<nav id="TOC">
<ul>
<li><a href="#using-panama-foreign-jdk">Using Panama &quot;foreign&quot; JDK</a><ul>
<li><a href="#embedding-python-interpreter-in-your-java-program-mac-os">Embedding Python interpreter in your Java program (Mac OS)</a><ul>
<li><a href="#jextract-a-jar-file-for-python.h">jextract a Jar file for Python.h</a></li>
<li><a href="#java-program-that-uses-extracted-python-interface">Java program that uses extracted Python interface</a></li>
<li><a href="#running-the-java-code-that-calls-python-interpreter">Running the Java code that calls Python interpreter</a></li>
</ul></li>
<li><a href="#embedding-python-interpreter-in-your-java-program-ubuntu-16.04">Embedding Python interpreter in your Java program (Ubuntu 16.04)</a><ul>
<li><a href="#jextract-a-jar-file-for-python.h-1">jextract a Jar file for Python.h</a></li>
<li><a href="#compiling-and-running-python-java-example">Compiling and Running Python Java example</a></li>
</ul></li>
<li><a href="#using-blas-library">Using BLAS library</a><ul>
<li><a href="#installing-openblas-mac-os">Installing OpenBLAS (Mac OS)</a></li>
<li><a href="#installing-openblas-ubuntu-16.04">Installing OpenBLAS (Ubuntu 16.04)</a></li>
<li><a href="#jextracting-cblas.h-macos">jextracting cblas.h (MacOS)</a></li>
<li><a href="#jextracting-cblas.h-ubuntu-16.04">jextracting cblas.h (Ubuntu 16.04)</a></li>
<li><a href="#java-sample-code-that-uses-cblas-library">Java sample code that uses cblas library</a></li>
<li><a href="#compiling-and-running-the-above-cblas-samples">Compiling and running the above cblas samples</a></li>
</ul></li>
<li><a href="#using-lapack-library-ubuntu">Using LAPACK library (Ubuntu)</a><ul>
<li><a href="#jextracting-clapack.h-ubuntu-16.04">jextracting clapack.h (Ubuntu 16.04)</a></li>
<li><a href="#java-sample-code-that-uses-lapack-library">Java sample code that uses LAPACK library</a></li>
<li><a href="#compiling-and-running-the-above-lapack-sample">Compiling and running the above LAPACK sample</a></li>
</ul></li>
<li><a href="#using-libproc-library-to-list-processes-from-java-mac-os">Using libproc library to list processes from Java (Mac OS)</a><ul>
<li><a href="#jextract-a-jar-file-for-libproc.h">jextract a jar file for libproc.h</a></li>
<li><a href="#java-program-that-uses-libproc-to-list-processes">Java program that uses libproc to list processes</a></li>
<li><a href="#running-the-java-code-that-uses-libproc">Running the Java code that uses libproc</a></li>
</ul></li>
<li><a href="#using-readline-library-from-java-code-mac-os">Using readline library from Java code (Mac OS)</a><ul>
<li><a href="#jextract-a-jar-file-for-readline.h">jextract a jar file for readline.h</a></li>
<li><a href="#java-code-that-uses-readline">Java code that uses readline</a></li>
<li><a href="#running-the-java-code-that-uses-readline">Running the java code that uses readline</a></li>
</ul></li>
<li><a href="#using-unistd.h-from-java-code-linux">Using unistd.h from Java code (Linux)</a><ul>
<li><a href="#jextract-a-jar-file-for-unistd.h">jextract a jar file for unistd.h</a></li>
<li><a href="#java-code-that-calls-getpid">Java code that calls getpid</a></li>
<li><a href="#running-the-java-code-that-uses-getpid">Running the Java code that uses getpid</a></li>
</ul></li>
<li><a href="#using-opengl-graphic-library-ubuntu-16.04">Using OpenGL graphic library (Ubuntu 16.04)</a><ul>
<li><a href="#installing-opengl-ubuntu-16.04">Installing OpenGL (Ubuntu 16.04)</a></li>
<li><a href="#jextracting-opengl-ubuntu-16.04">jextracting OpenGL (Ubuntu 16.04)</a></li>
<li><a href="#java-sample-code-that-uses-the-opengl-library">Java sample code that uses the OpenGL library</a></li>
<li><a href="#running-the-java-code-that-uses-opengl">Running the Java code that uses OpenGL</a></li>
</ul></li>
<li><a href="#using-tensorflow-c-api-mac-os">Using TensorFlow C API (Mac OS)</a><ul>
<li><a href="#installing-libtensorflow">Installing libtensorflow</a></li>
<li><a href="#jextracting-libtensorflow-c_api.h">jextracting libtensorflow c_api.h</a></li>
<li><a href="#java-sample-code-that-uses-tensorflow-library">Java sample code that uses tensorflow library</a></li>
<li><a href="#compiling-and-running-the-above-tensorflow-sample">Compiling and running the above TensorFlow sample</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
<h1 id="using-panama-foreign-jdk">Using Panama &quot;foreign&quot; JDK</h1>
<p>There are two ways to get a panama foreign branch JDK.</p>
<ol type="1">
<li>Locally build &quot;foreign&quot; branch of panama repo <a href="http://hg.openjdk.java.net/panama/dev/" class="uri">http://hg.openjdk.java.net/panama/dev/</a></li>
<li>Download pre-built panama &quot;foreign&quot; early access binaries from <a href="http://jdk.java.net/panama/" class="uri">http://jdk.java.net/panama/</a></li>
</ol>
<p>Using foreign function call in Java involves the following three steps:</p>
<ol type="1">
<li>Use <strong>jextract</strong> tool to generate java interface for your C header file(s)</li>
<li>Use <strong>java.foreign</strong> API to create (&quot;bind&quot;) implementation for C header interfaces</li>
<li>Invoke C functions via the jextracted Java interface</li>
</ol>
<h2 id="embedding-python-interpreter-in-your-java-program-mac-os">Embedding Python interpreter in your Java program (Mac OS)</h2>
<h3 id="jextract-a-jar-file-for-python.h">jextract a Jar file for Python.h</h3>
<pre class="sh"><code>
jextract -l python2.7 \
  -rpath /System/Library/Frameworks/Python.framework/Versions/2.7/lib \
  --exclude-symbols .*_FromFormatV\|_.*\|PyOS_vsnprintf\|.*_VaParse.*\|.*_VaBuild.*\|PyBuffer_SizeFromFormat\|vasprintf\|vfprintf\|vprintf\|vsprintf \
  -t org.python \
  /usr/include/stdio.h /usr/include/stdlib.h /usr/include/python2.7/Python.h \
  -o python.jar
</code></pre>
<h3 id="java-program-that-uses-extracted-python-interface">Java program that uses extracted Python interface</h3>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">
<span class="co">// import java.foreign packages</span>
<span class="kw">import java.foreign.Libraries;</span>
<span class="kw">import java.foreign.Scope;</span>
<span class="kw">import java.foreign.memory.Pointer;</span>

<span class="co">// import jextracted python &#39;header&#39; classes</span>
<span class="kw">import static org.python.Python_h.*;</span>
<span class="kw">import static org.python.pythonrun_h.*;</span>

<span class="kw">public</span> <span class="kw">class</span> PythonMain {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(String[] args) {
        <span class="fu">Py_Initialize</span>();
        <span class="kw">try</span> (Scope s = Scope.<span class="fu">newNativeScope</span>()) {
            <span class="fu">PyRun_SimpleStringFlags</span>(s.<span class="fu">allocateCString</span>(
                <span class="st">&quot;print(sum([33, 55, 66])); print(&#39;Hello from Python!&#39;)</span><span class="ch">\n</span><span class="st">&quot;</span>),
                Pointer.<span class="fu">nullPointer</span>());
        }
        <span class="fu">Py_Finalize</span>();
    }
}</code></pre></div>
<h3 id="running-the-java-code-that-calls-python-interpreter">Running the Java code that calls Python interpreter</h3>
<pre class="sh"><code>
javac -cp pythor.jar PythonMain.java

java -cp python.jar:. PythonMain
</code></pre>
<h2 id="embedding-python-interpreter-in-your-java-program-ubuntu-16.04">Embedding Python interpreter in your Java program (Ubuntu 16.04)</h2>
<h3 id="jextract-a-jar-file-for-python.h-1">jextract a Jar file for Python.h</h3>
<pre class="sh"><code>
jextract -l python2.7 \
  -rpath /usr/lib/python2.7/config-x86_64-linux-gnu \
  --exclude-symbols .*_FromFormatV\|_.*\|PyOS_vsnprintf\|.*_VaParse.*\|.*_VaBuild.*\|PyBuffer_SizeFromFormat\|vasprintf\|vfprintf\|vprintf\|vsprintf \
  -t org.python \
  /usr/include/stdio.h /usr/include/stdlib.h /usr/include/python2.7/Python.h \
  -o python.jar
</code></pre>
<h3 id="compiling-and-running-python-java-example">Compiling and Running Python Java example</h3>
<p>Follow the instructions from the Mac OS section</p>
<h2 id="using-blas-library">Using BLAS library</h2>
<p>BLAS is a popular library that allows fast matrix and vector computation: <a href="http://www.netlib.org/blas/" class="uri">http://www.netlib.org/blas/</a>.</p>
<h3 id="installing-openblas-mac-os">Installing OpenBLAS (Mac OS)</h3>
<p>On Mac, blas is available as part of the OpenBLAS library: <a href="https://github.com/xianyi/OpenBLAS/wiki" class="uri">https://github.com/xianyi/OpenBLAS/wiki</a></p>
<p>OpenBLAS is an optimized BLAS library based on GotoBLAS2 1.13 BSD version.</p>
<p>You can install openblas using HomeBrew</p>
<pre class="sh"><code>
brew install openblas
</code></pre>
<p>It installs include and lib directories under /usr/local/opt/openblas</p>
<h3 id="installing-openblas-ubuntu-16.04">Installing OpenBLAS (Ubuntu 16.04)</h3>
<p>On Ubuntu, blas is distributed as part of the atlas library: <a href="http://math-atlas.sourceforge.net/" class="uri">http://math-atlas.sourceforge.net/</a>.</p>
<p>You can install atlas using apt</p>
<pre class="sh"><code>
sudo apt-get install libatlas-base-dev
</code></pre>
<p>This command will install include files under <code>/usr/include/atlas</code> and corresponding libraries under <code>/usr/lib/atlas-dev</code>.</p>
<h3 id="jextracting-cblas.h-macos">jextracting cblas.h (MacOS)</h3>
<p>The following command can be used to extract cblas.h on MacOs</p>
<pre class="sh"><code>
jextract -C &quot;-D FORCE_OPENBLAS_COMPLEX_STRUCT&quot; \
  -L /usr/local/opt/openblas/lib -I /usr/local/opt/openblas \
  -l openblas -t blas -infer-rpath /usr/local/opt/openblas/include/cblas.h \
  -o cblas.jar
</code></pre>
<p>The FORCE_OPENBLAS_COMPLEX_STRUCT define is needed because jextract does not yet handle C99 <code>_Complex</code> types. The rest of the options are standard ones.</p>
<h3 id="jextracting-cblas.h-ubuntu-16.04">jextracting cblas.h (Ubuntu 16.04)</h3>
<p>The following command can be used to extract cblas.h on Ubuntu</p>
<pre class="sh"><code>
jextract -L /usr/lib/atlas-base -I /usr/include/atlas/ \
   -l cblas -t blas -infer-rpath \
   /usr/include/atlas/cblas.h -o cblas.jar
</code></pre>
<h3 id="java-sample-code-that-uses-cblas-library">Java sample code that uses cblas library</h3>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">
<span class="kw">import blas.cblas;</span>

<span class="kw">import static blas.cblas_h.*;</span>

<span class="kw">import java.foreign.NativeTypes;</span>
<span class="kw">import java.foreign.Scope;</span>
<span class="kw">import java.foreign.memory.Array;</span>

<span class="kw">public</span> <span class="kw">class</span> TestBlas {
   <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(String[] args) {
       <span class="fu">@cblas</span>.<span class="fu">CBLAS_ORDER</span> <span class="dt">int</span> Layout;
       <span class="fu">@cblas</span>.<span class="fu">CBLAS_TRANSPOSE</span> <span class="dt">int</span> transa;

       <span class="dt">double</span> alpha, beta;
       <span class="dt">int</span> m, n, lda, incx, incy, i;

       Layout = CblasColMajor;
       transa = CblasNoTrans;

       m = <span class="dv">4</span>; <span class="co">/* Size of Column ( the number of rows ) */</span>
       n = <span class="dv">4</span>; <span class="co">/* Size of Row ( the number of columns ) */</span>
       lda = <span class="dv">4</span>; <span class="co">/* Leading dimension of 5 * 4 matrix is 5 */</span>
       incx = <span class="dv">1</span>;
       incy = <span class="dv">1</span>;
       alpha = <span class="dv">1</span>;
       beta = <span class="dv">0</span>;

       <span class="kw">try</span> (Scope sc = Scope.<span class="fu">newNativeScope</span>()){
           Array&lt;Double&gt; a = sc.<span class="fu">allocateArray</span>(NativeTypes.<span class="fu">DOUBLE</span>, m * n);
           Array&lt;Double&gt; x = sc.<span class="fu">allocateArray</span>(NativeTypes.<span class="fu">DOUBLE</span>, n);
           Array&lt;Double&gt; y = sc.<span class="fu">allocateArray</span>(NativeTypes.<span class="fu">DOUBLE</span>, n);
           <span class="co">/* The elements of the first column */</span>
           a.<span class="fu">set</span>(<span class="dv">0</span>, <span class="fl">1.0</span>);
           a.<span class="fu">set</span>(<span class="dv">1</span>, <span class="fl">2.0</span>);
           a.<span class="fu">set</span>(<span class="dv">2</span>, <span class="fl">3.0</span>);
           a.<span class="fu">set</span>(<span class="dv">3</span>, <span class="fl">4.0</span>);
           <span class="co">/* The elements of the second column */</span>
           a.<span class="fu">set</span>(m, <span class="fl">1.0</span>);
           a.<span class="fu">set</span>(m + <span class="dv">1</span>, <span class="fl">1.0</span>);
           a.<span class="fu">set</span>(m + <span class="dv">2</span>, <span class="fl">1.0</span>);
           a.<span class="fu">set</span>(m + <span class="dv">3</span>, <span class="fl">1.0</span>);
           <span class="co">/* The elements of the third column */</span>
           a.<span class="fu">set</span>(m * <span class="dv">2</span>, <span class="fl">3.0</span>);
           a.<span class="fu">set</span>(m * <span class="dv">2</span> + <span class="dv">1</span>, <span class="fl">4.0</span>);
           a.<span class="fu">set</span>(m * <span class="dv">2</span> + <span class="dv">2</span>, <span class="fl">5.0</span>);
           a.<span class="fu">set</span>(m * <span class="dv">2</span> + <span class="dv">3</span>, <span class="fl">6.0</span>);
           <span class="co">/* The elements of the fourth column */</span>
           a.<span class="fu">set</span>(m * <span class="dv">3</span>, <span class="fl">5.0</span>);
           a.<span class="fu">set</span>(m * <span class="dv">3</span> + <span class="dv">1</span>, <span class="fl">6.0</span>);
           a.<span class="fu">set</span>(m * <span class="dv">3</span> + <span class="dv">2</span>, <span class="fl">7.0</span>);
           a.<span class="fu">set</span>(m * <span class="dv">3</span> + <span class="dv">3</span>, <span class="fl">8.0</span>);
           <span class="co">/* The elemetns of x and y */</span>
           x.<span class="fu">set</span>(<span class="dv">0</span>, <span class="fl">1.0</span>);
           x.<span class="fu">set</span>(<span class="dv">1</span>, <span class="fl">2.0</span>);
           x.<span class="fu">set</span>(<span class="dv">2</span>, <span class="fl">1.0</span>);
           x.<span class="fu">set</span>(<span class="dv">3</span>, <span class="fl">1.0</span>);
           y.<span class="fu">set</span>(<span class="dv">0</span>, <span class="fl">0.0</span>);
           y.<span class="fu">set</span>(<span class="dv">1</span>, <span class="fl">0.0</span>);
           y.<span class="fu">set</span>(<span class="dv">2</span>, <span class="fl">0.0</span>);
           y.<span class="fu">set</span>(<span class="dv">3</span>, <span class="fl">0.0</span>);

           <span class="fu">cblas_dgemv</span>(Layout, transa, m, n, alpha, a.<span class="fu">elementPointer</span>(), lda, x.<span class="fu">elementPointer</span>(), incx, beta,
                   y.<span class="fu">elementPointer</span>(), incy);
           <span class="co">/* Print y */</span>
           <span class="kw">for</span> (i = <span class="dv">0</span>; i &lt; n; i++)
               System.<span class="fu">out</span>.<span class="fu">print</span>(String<span class="fu">.format</span>(<span class="st">&quot; y</span><span class="ch">%d</span><span class="st"> = </span><span class="ch">%f\n</span><span class="st">&quot;</span>, i, y.<span class="fu">get</span>(i)));
       }
   }
}</code></pre></div>
<h3 id="compiling-and-running-the-above-cblas-samples">Compiling and running the above cblas samples</h3>
<pre class="sh"><code>
javac -cp cblas.jar TestBlas.java

java -cp cblas.jar:. TestBlas
</code></pre>
<h2 id="using-lapack-library-ubuntu">Using LAPACK library (Ubuntu)</h2>
<p>On Ubuntu, the same steps used to install the blas (via atlas) library also install headers and libraries for the LAPACK library, a linear algebra computation library built on top of blas.</p>
<h3 id="jextracting-clapack.h-ubuntu-16.04">jextracting clapack.h (Ubuntu 16.04)</h3>
<p>The following command can be used to extract the LAPACK header:</p>
<pre class="sh"><code>
jextract -L /usr/lib/atlas-base/atlas -I /usr/include/atlas/ \
   -l lapack -t lapack -infer-rpath /usr/include/atlas/clapack.h -o clapack.jar
</code></pre>
<h3 id="java-sample-code-that-uses-lapack-library">Java sample code that uses LAPACK library</h3>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">import java.foreign.NativeTypes;</span>
<span class="kw">import java.foreign.Scope;</span>
<span class="kw">import java.foreign.memory.Array;</span>

<span class="kw">import static lapack.clapack_h.*;</span>
<span class="kw">import static lapack.cblas_h.*;</span>

<span class="kw">public</span> <span class="kw">class</span> TestLapack {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(String[] args) {

        <span class="co">/* Locals */</span>
        <span class="kw">try</span> (Scope sc = Scope.<span class="fu">newNativeScope</span>()) {
            Array&lt;Double&gt; A = sc.<span class="fu">allocateArray</span>(NativeTypes.<span class="fu">DOUBLE</span>, <span class="kw">new</span> <span class="dt">double</span>[]{
                    <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">3</span>
            });
            Array&lt;Double&gt; b = sc.<span class="fu">allocateArray</span>(NativeTypes.<span class="fu">DOUBLE</span>, <span class="kw">new</span> <span class="dt">double</span>[]{
                    -<span class="dv">10</span>, <span class="dv">12</span>, <span class="dv">14</span>, <span class="dv">16</span>, <span class="dv">18</span>, -<span class="dv">3</span>, <span class="dv">14</span>, <span class="dv">12</span>, <span class="dv">16</span>, <span class="dv">16</span>
            });
            <span class="dt">int</span> info, m, n, lda, ldb, nrhs;

            <span class="co">/* Initialization */</span>
            m = <span class="dv">5</span>;
            n = <span class="dv">3</span>;
            nrhs = <span class="dv">2</span>;
            lda = <span class="dv">5</span>;
            ldb = <span class="dv">5</span>;

            <span class="co">/* Print Entry Matrix */</span>
            <span class="fu">print_matrix_colmajor</span>(<span class="st">&quot;Entry Matrix A&quot;</span>, m, n, A, lda );
            <span class="co">/* Print Right Rand Side */</span>
            <span class="fu">print_matrix_colmajor</span>(<span class="st">&quot;Right Hand Side b&quot;</span>, n, nrhs, b, ldb );
            System.<span class="fu">out</span>.<span class="fu">println</span>();

            <span class="co">/* Executable statements */</span>
            <span class="co">//            printf( &quot;LAPACKE_dgels (col-major, high-level) Example Program Results\n&quot; );</span>
            <span class="co">/* Solve least squares problem*/</span>
            info = <span class="fu">clapack_dgels</span>(CblasColMajor, CblasNoTrans, m, n, nrhs, A.<span class="fu">elementPointer</span>(), lda, b.<span class="fu">elementPointer</span>(), ldb);

            <span class="co">/* Print Solution */</span>
            <span class="fu">print_matrix_colmajor</span>(<span class="st">&quot;Solution&quot;</span>, n, nrhs, b, ldb );
            System.<span class="fu">out</span>.<span class="fu">println</span>();
            System.<span class="fu">exit</span>(info);
        }
    }

    <span class="dt">static</span> <span class="dt">void</span> <span class="fu">print_matrix_colmajor</span>(String msg, <span class="dt">int</span> m, <span class="dt">int</span> n, Array&lt;Double&gt; mat, <span class="dt">int</span> ldm) {
        <span class="dt">int</span> i, j;
        System.<span class="fu">out.printf</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st"> </span><span class="ch">%s\n</span><span class="st">&quot;</span>, msg);

        <span class="kw">for</span>( i = <span class="dv">0</span>; i &lt; m; i++ ) {
            <span class="kw">for</span>( j = <span class="dv">0</span>; j &lt; n; j++ ) System.<span class="fu">out.printf</span>(<span class="st">&quot; </span><span class="ch">%6.2f</span><span class="st">&quot;</span>, mat.<span class="fu">get</span>(i+j*ldm));
            System.<span class="fu">out.printf</span>( <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span> );
        }
    }
}</code></pre></div>
<h3 id="compiling-and-running-the-above-lapack-sample">Compiling and running the above LAPACK sample</h3>
<pre class="sh"><code>
javac -cp clapack.jar TestLapack.java

java -cp clapack.jar:. TestLapack
</code></pre>
<h2 id="using-libproc-library-to-list-processes-from-java-mac-os">Using libproc library to list processes from Java (Mac OS)</h2>
<h3 id="jextract-a-jar-file-for-libproc.h">jextract a jar file for libproc.h</h3>
<p>jextract -t org.unix -lproc -rpath /usr/lib -o libproc.jar /usr/include/libproc.h</p>
<h3 id="java-program-that-uses-libproc-to-list-processes">Java program that uses libproc to list processes</h3>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">
<span class="kw">import java.foreign.*;</span>
<span class="kw">import java.foreign.memory.*;</span>
<span class="kw">import static org.unix.libproc_h.*;</span>

<span class="kw">public</span> <span class="kw">class</span> LibprocMain {
    <span class="kw">private</span> <span class="dt">static</span> <span class="dt">final</span> <span class="dt">int</span> NAME_BUF_MAX = <span class="dv">256</span>;

    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(String[] args) {
        <span class="co">// Scope for native allocations</span>
        <span class="kw">try</span> (Scope s = Scope.<span class="fu">newNativeScope</span>()) {
            <span class="co">// get the number of processes</span>
            <span class="dt">int</span> numPids = <span class="fu">proc_listallpids</span>(Pointer.<span class="fu">nullPointer</span>(), <span class="dv">0</span>);
            <span class="co">// allocate an array</span>
            Array&lt;Integer&gt; pids = s.<span class="fu">allocateArray</span>(NativeTypes.<span class="fu">INT32</span>, numPids);
            <span class="co">// list all the pids into the native array</span>
            <span class="fu">proc_listallpids</span>(pids.<span class="fu">elementPointer</span>(), numPids);
            <span class="co">// convert native array to java array</span>
            <span class="dt">int</span>[] jpids = pids.<span class="fu">toArray</span>(num -&gt; <span class="kw">new</span> <span class="dt">int</span>[num]);
            <span class="co">// buffer for process name</span>
            Pointer&lt;Byte&gt; nameBuf = s.<span class="fu">allocate</span>(NativeTypes.<span class="fu">INT8</span>, NAME_BUF_MAX);
            <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; jpids.<span class="fu">length</span>; i++) {
                <span class="dt">int</span> pid = jpids[i];
                <span class="co">// get the process name</span>
                <span class="fu">proc_name</span>(pid, nameBuf, NAME_BUF_MAX);
                String procName = Pointer.<span class="fu">toString</span>(nameBuf);
                <span class="co">// print pid and process name</span>
                System.<span class="fu">out.printf</span>(<span class="st">&quot;</span><span class="ch">%d</span><span class="st"> </span><span class="ch">%s\n</span><span class="st">&quot;</span>, pid, procName);
            }
        }
    }
}</code></pre></div>
<h3 id="running-the-java-code-that-uses-libproc">Running the Java code that uses libproc</h3>
<pre class="sh"><code>
javac -cp libproc.jar LibprocMain.java

java -cp libproc.jar:. LibprocMain
</code></pre>
<h2 id="using-readline-library-from-java-code-mac-os">Using readline library from Java code (Mac OS)</h2>
<h3 id="jextract-a-jar-file-for-readline.h">jextract a jar file for readline.h</h3>
<pre class="sh"><code>
jextract -l readline -rpath /usr/local/opt/readline/lib/ \
    -t org.unix \
    /usr/include/readline/readline.h /usr/include/_stdio.h \
    --exclude-symbol readline_echoing_p -o readline.jar
</code></pre>
<h3 id="java-code-that-uses-readline">Java code that uses readline</h3>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">
<span class="kw">import java.foreign.*;</span>
<span class="kw">import java.foreign.memory.*;</span>
<span class="kw">import static org.unix.readline_h.*;</span>

<span class="kw">public</span> <span class="kw">class</span> Readline {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(String[] args) {
        <span class="co">// Scope for native allocations</span>
        <span class="kw">try</span> (Scope s = Scope.<span class="fu">newNativeScope</span>()) {
            <span class="co">// allocate C memory initialized with Java string content</span>
            var pstr = s.<span class="fu">allocateCString</span>(<span class="st">&quot;name? &quot;</span>);

            <span class="co">// call &quot;readline&quot; API</span>
            var p = <span class="fu">readline</span>(pstr);

            <span class="co">// print char* as is</span>
            System.<span class="fu">out</span>.<span class="fu">println</span>(p);
            <span class="co">// convert char* ptr from readline as Java String &amp; print it</span>
            System.<span class="fu">out</span>.<span class="fu">println</span>(Pointer.<span class="fu">toString</span>(p));
        }
    }
}</code></pre></div>
<h3 id="running-the-java-code-that-uses-readline">Running the java code that uses readline</h3>
<pre><code>
javac -cp readline.jar Readline.java

java -cp readline.jar:. Readline
</code></pre>
<h2 id="using-unistd.h-from-java-code-linux">Using unistd.h from Java code (Linux)</h2>
<h3 id="jextract-a-jar-file-for-unistd.h">jextract a jar file for unistd.h</h3>
<pre class="sh"><code>
jextract /usr/include/unistd.h -t org.unix -o unistd.jar
</code></pre>
<h3 id="java-code-that-calls-getpid">Java code that calls getpid</h3>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">
<span class="kw">import java.foreign.*;</span>
<span class="kw">import java.lang.invoke.*;</span>
<span class="kw">import org.unix.unistd;</span>


<span class="kw">public</span> <span class="kw">class</span> Getpid {
    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(String[] args) {
        <span class="co">// bind unistd interface</span>
        var u = Libraries.<span class="fu">bind</span>(MethodHandles.<span class="fu">lookup</span>(), unistd.<span class="fu">class</span>);
        <span class="co">// call getpid from the unistd.h</span>
        System.<span class="fu">out</span>.<span class="fu">println</span>(u.<span class="fu">getpid</span>());
        <span class="co">// check process id from Java API!</span>
        System.<span class="fu">out</span>.<span class="fu">println</span>(ProcessHandle.<span class="fu">current</span>().<span class="fu">pid</span>());
    }
}</code></pre></div>
<h3 id="running-the-java-code-that-uses-getpid">Running the Java code that uses getpid</h3>
<pre class="sh"><code>
javac -cp unistd.jar Getpid.java

java -cp unistd.jar:. Getpid
</code></pre>
<h2 id="using-opengl-graphic-library-ubuntu-16.04">Using OpenGL graphic library (Ubuntu 16.04)</h2>
<p>OpenGL is a popular portable graphic library: <a href="https://www.opengl.org/" class="uri">https://www.opengl.org/</a></p>
<h3 id="installing-opengl-ubuntu-16.04">Installing OpenGL (Ubuntu 16.04)</h3>
<p>Installing relevant OpenGL headers and libraries can be a bit tricky, as it depends on what graphic card is installed on the target platform. The following instruction assume that the standard version of OpenGL is used (e.g. mesa), rather than a proprietary one (Nvidia or AMD), although the changes to get these working are rather small.</p>
<p>OpenGL is always coupled with a bunch of other libraries, namely GLU and glut. You can install all those libraries using <code>apt</code>, as follows:</p>
<pre class="sh"><code>
sudo apt-get install libgl1-mesa-dev libglu1-mesa-dev freeglut3-dev
</code></pre>
<p>If the installation was successful, OpenGL headers can be found under <code>/usr/include/GL</code>, while libraries can be found in the folder <code>/usr/lib/x86_64-linux-gnu/</code>.</p>
<h3 id="jextracting-opengl-ubuntu-16.04">jextracting OpenGL (Ubuntu 16.04)</h3>
<p>To extract the opengl libraries the following command suffices:</p>
<pre class="sh"><code>
jextract -L /usr/lib/x86_64-linux-gnu  -l glut -l GLU -l GL --infer-rpath -t opengl -o opengl.jar /usr/include/GL/glut.h
</code></pre>
<p>Since glut depends on the other libraries (GLU and GL), it is not necessary to give additional headers to jextract.</p>
<h3 id="java-sample-code-that-uses-the-opengl-library">Java sample code that uses the OpenGL library</h3>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">import java.foreign.Libraries;</span>
<span class="kw">import java.foreign.NativeTypes;</span>
<span class="kw">import java.foreign.Scope;</span>
<span class="kw">import java.foreign.memory.Array;</span>
<span class="kw">import java.foreign.memory.Pointer;</span>
<span class="kw">import java.lang.invoke.MethodHandles;</span>

<span class="kw">import opengl.*;</span>

<span class="kw">import javax.imageio.ImageIO;</span>

<span class="kw">public</span> <span class="kw">class</span> Teapot {
    <span class="dt">static</span> gl gl = Libraries.<span class="fu">bind</span>(MethodHandles.<span class="fu">lookup</span>(), gl.<span class="fu">class</span>);
    <span class="dt">static</span> freeglut_std glut = Libraries.<span class="fu">bind</span>(MethodHandles.<span class="fu">lookup</span>(), freeglut_std.<span class="fu">class</span>);

    <span class="dt">float</span> rot = <span class="dv">0</span>;

    <span class="fu">Teapot</span>(Scope sc) {
        <span class="co">// Misc Parameters</span>
        Array&lt;Float&gt; pos = sc.<span class="fu">allocateArray</span>(NativeTypes.<span class="fu">FLOAT</span>, <span class="kw">new</span> <span class="dt">float</span>[] {<span class="fl">0.</span>0f, <span class="fl">15.</span>0f, -<span class="fl">15.</span>0f, <span class="dv">0</span>});
        Array&lt;Float&gt; spec = sc.<span class="fu">allocateArray</span>(NativeTypes.<span class="fu">FLOAT</span>, <span class="kw">new</span> <span class="dt">float</span>[] {<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>});
        Array&lt;Float&gt; shini = sc.<span class="fu">allocateArray</span>(NativeTypes.<span class="fu">FLOAT</span>, <span class="kw">new</span> <span class="dt">float</span>[] {<span class="dv">113</span>});

        <span class="co">// Reset Background</span>
        gl.<span class="fu">glClearColor</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>);

        <span class="co">// Setup Lighting</span>
        gl.<span class="fu">glShadeModel</span>(gl.<span class="fu">GL_SMOOTH</span>());
        gl.<span class="fu">glLightfv</span>(gl.<span class="fu">GL_LIGHT0</span>(), gl.<span class="fu">GL_POSITION</span>(), pos.<span class="fu">elementPointer</span>());
        gl.<span class="fu">glLightfv</span>(gl.<span class="fu">GL_LIGHT0</span>(), gl.<span class="fu">GL_AMBIENT</span>(), spec.<span class="fu">elementPointer</span>());
        gl.<span class="fu">glLightfv</span>(gl.<span class="fu">GL_LIGHT0</span>(), gl.<span class="fu">GL_DIFFUSE</span>(), spec.<span class="fu">elementPointer</span>());
        gl.<span class="fu">glLightfv</span>(gl.<span class="fu">GL_LIGHT0</span>(), gl.<span class="fu">GL_SPECULAR</span>(), spec.<span class="fu">elementPointer</span>());
        gl.<span class="fu">glMaterialfv</span>(gl.<span class="fu">GL_FRONT</span>(), gl.<span class="fu">GL_SHININESS</span>(), shini.<span class="fu">elementPointer</span>());
        gl.<span class="fu">glEnable</span>(gl.<span class="fu">GL_LIGHTING</span>());
        gl.<span class="fu">glEnable</span>(gl.<span class="fu">GL_LIGHT0</span>());
        gl.<span class="fu">glEnable</span>(gl.<span class="fu">GL_DEPTH_TEST</span>());
    }

    <span class="dt">void</span> <span class="fu">display</span>() {
        gl.<span class="fu">glClear</span>(gl.<span class="fu">GL_COLOR_BUFFER_BIT</span>() | gl.<span class="fu">GL_DEPTH_BUFFER_BIT</span>());
        gl.<span class="fu">glPushMatrix</span>();
        gl.<span class="fu">glRotatef</span>(-<span class="dv">20</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>);
        gl.<span class="fu">glRotatef</span>(rot, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>);
        glut.<span class="fu">glutSolidTeapot</span>(<span class="fl">0.5</span>);
        gl.<span class="fu">glPopMatrix</span>();
        glut.<span class="fu">glutSwapBuffers</span>();
    }

    <span class="dt">void</span> <span class="fu">onIdle</span>() {
        rot += <span class="fl">0.1</span>;
        glut.<span class="fu">glutPostRedisplay</span>();
    }

    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(String[] args) {
        <span class="kw">try</span> (Scope sc = Scope.<span class="fu">newNativeScope</span>()) {
            Pointer&lt;Integer&gt; argc = sc.<span class="fu">allocate</span>(NativeTypes.<span class="fu">INT32</span>);
            argc.<span class="fu">set</span>(<span class="dv">0</span>);
            glut.<span class="fu">glutInit</span>(argc, Pointer.<span class="fu">nullPointer</span>());
            glut.<span class="fu">glutInitDisplayMode</span>(glut.<span class="fu">GLUT_DOUBLE</span>() | glut.<span class="fu">GLUT_RGBA</span>() | glut.<span class="fu">GLUT_DEPTH</span>());
            glut.<span class="fu">glutInitWindowSize</span>(<span class="dv">900</span>, <span class="dv">900</span>);
            glut.<span class="fu">glutCreateWindow</span>(sc.<span class="fu">allocateCString</span>(<span class="st">&quot;Hello Panama!&quot;</span>));
            Teapot teapot = <span class="kw">new</span> <span class="fu">Teapot</span>(sc);
            glut.<span class="fu">glutDisplayFunc</span>(sc.<span class="fu">allocateCallback</span>(teapot::display));
            glut.<span class="fu">glutIdleFunc</span>(sc.<span class="fu">allocateCallback</span>(teapot::onIdle));
            glut.<span class="fu">glutMainLoop</span>();
        }
    }
}</code></pre></div>
<h3 id="running-the-java-code-that-uses-opengl">Running the Java code that uses OpenGL</h3>
<pre class="sh"><code>
javac -cp opengl.jar Teapot.java

java -cp opengl.jar:. Teapot
</code></pre>
<h2 id="using-tensorflow-c-api-mac-os">Using TensorFlow C API (Mac OS)</h2>
<p>Quoted from <a href="https://www.tensorflow.org/install/lang_c" class="uri">https://www.tensorflow.org/install/lang_c</a></p>
<p>&quot;TensorFlow provides a C API that can be used to build bindings for other languages. The API is defined in c_api.h and designed for simplicity and uniformity rather than convenience.&quot;</p>
<h3 id="installing-libtensorflow">Installing libtensorflow</h3>
<p>You can follow the setup procedure as described in the above page.</p>
<p>Alternatively, on Mac, you can install libtensorflow using HomeBrew</p>
<pre class="sh"><code>
brew install libtensorflow
</code></pre>
<p>Tensorflow ship the libtensorflow with an .so extension, this doesn't work well for java on MacOS as java expect .dylib extension. To work around this, create a symbolic link.</p>
<pre class="sh"><code>
sudo ln -s /usr/local/lib/libtensorflow.so /usr/local/lib/libtensorflow.dylib
</code></pre>
<h3 id="jextracting-libtensorflow-c_api.h">jextracting libtensorflow c_api.h</h3>
<p>The following command can be used to extract c_api.h.</p>
<pre class="sh"><code>
jextract -C -x -C c++  \
        -L /usr/local/lib -l tensorflow -infer-rpath \
        -o tf.jar -t org.tensorflow.panama \
        /usr/local/include/tensorflow/c/c_api.h
</code></pre>
<p>The caveat to extract tensorflow C API is that it declare function prototype without argument in C++ style, for example, TF_Version(), which is considered incomplete C function prototype instead of C style as in TF_Version(void). An incomplete function prototype will become vararg funciton. To avoid that, we need to pass clang '-x c++' options to jextract with '-C -x -C c++'</p>
<h3 id="java-sample-code-that-uses-tensorflow-library">Java sample code that uses tensorflow library</h3>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">
<span class="kw">import java.foreign.NativeTypes;</span>
<span class="kw">import java.foreign.Scope;</span>
<span class="kw">import java.foreign.memory.Array;</span>
<span class="kw">import java.foreign.memory.LayoutType;</span>
<span class="kw">import java.foreign.memory.Pointer;</span>
<span class="kw">import org.tensorflow.panama.c_api.TF_DataType;</span>
<span class="kw">import org.tensorflow.panama.c_api.TF_Graph;</span>
<span class="kw">import org.tensorflow.panama.c_api.TF_Operation;</span>
<span class="kw">import org.tensorflow.panama.c_api.TF_OperationDescription;</span>
<span class="kw">import org.tensorflow.panama.c_api.TF_Output;</span>
<span class="kw">import org.tensorflow.panama.c_api.TF_Session;</span>
<span class="kw">import org.tensorflow.panama.c_api.TF_SessionOptions;</span>
<span class="kw">import org.tensorflow.panama.c_api.TF_Status;</span>
<span class="kw">import org.tensorflow.panama.c_api.TF_Tensor;</span>

<span class="kw">import static org.tensorflow.panama.c_api_h.*;</span>

<span class="kw">public</span> <span class="kw">class</span> TensorFlowExample {
    <span class="dt">static</span> Pointer&lt;TF_Operation&gt; <span class="fu">PlaceHolder</span>(Pointer&lt;TF_Graph&gt; graph, Pointer&lt;TF_Status&gt; status,
                                      <span class="fu">@TF_DataType</span> <span class="dt">int</span> dtype, String name) {
        <span class="kw">try</span> (var s = Scope.<span class="fu">newNativeScope</span>()) {
            Pointer&lt;TF_OperationDescription&gt; desc = <span class="fu">TF_NewOperation</span>(graph,
                    s.<span class="fu">allocateCString</span>(<span class="st">&quot;Placeholder&quot;</span>), s.<span class="fu">allocateCString</span>(name));
            <span class="fu">TF_SetAttrType</span>(desc, s.<span class="fu">allocateCString</span>(<span class="st">&quot;dtype&quot;</span>), TF_FLOAT);
            <span class="kw">return</span> <span class="fu">TF_FinishOperation</span>(desc, status);
        }
    }

    <span class="dt">static</span> Pointer&lt;TF_Operation&gt; <span class="fu">ConstValue</span>(Pointer&lt;TF_Graph&gt; graph, Pointer&lt;TF_Status&gt; status,
                                Pointer&lt;TF_Tensor&gt; tensor, String name) {
        <span class="kw">try</span> (var s = Scope.<span class="fu">newNativeScope</span>()) {
            Pointer&lt;TF_OperationDescription&gt; desc = <span class="fu">TF_NewOperation</span>(graph,
                    s.<span class="fu">allocateCString</span>(<span class="st">&quot;Const&quot;</span>), s.<span class="fu">allocateCString</span>(name));
            <span class="fu">TF_SetAttrTensor</span>(desc, s.<span class="fu">allocateCString</span>(<span class="st">&quot;value&quot;</span>), tensor, status);
            <span class="fu">TF_SetAttrType</span>(desc, s.<span class="fu">allocateCString</span>(<span class="st">&quot;dtype&quot;</span>), <span class="fu">TF_TensorType</span>(tensor));
            <span class="kw">return</span> <span class="fu">TF_FinishOperation</span>(desc, status);
        }
    }

    <span class="dt">static</span> Pointer&lt;TF_Operation&gt; <span class="fu">Add</span>(Pointer&lt;TF_Graph&gt; graph, Pointer&lt;TF_Status&gt; status,
                              Pointer&lt;TF_Operation&gt; one, Pointer&lt;TF_Operation&gt; two,
                              String name) {
        <span class="kw">try</span> (var s = Scope.<span class="fu">newNativeScope</span>()) {
            Pointer&lt;TF_OperationDescription&gt; desc = <span class="fu">TF_NewOperation</span>(graph,
                    s.<span class="fu">allocateCString</span>(<span class="st">&quot;AddN&quot;</span>), s.<span class="fu">allocateCString</span>(name));
            Array&lt;TF_Output&gt; add_inputs = s.<span class="fu">allocateArray</span>(
                    LayoutType.<span class="fu">ofStruct</span>(TF_Output.<span class="fu">class</span>),<span class="dv">2</span>);
            add_inputs.<span class="fu">get</span>(<span class="dv">0</span>).<span class="fu">oper</span>$<span class="fu">set</span>(one);
            add_inputs.<span class="fu">get</span>(<span class="dv">0</span>).<span class="fu">index</span>$<span class="fu">set</span>(<span class="dv">0</span>);
            add_inputs.<span class="fu">get</span>(<span class="dv">1</span>).<span class="fu">oper</span>$<span class="fu">set</span>(two);
            add_inputs.<span class="fu">get</span>(<span class="dv">1</span>).<span class="fu">index</span>$<span class="fu">set</span>(<span class="dv">0</span>);
            <span class="fu">TF_AddInputList</span>(desc, add_inputs.<span class="fu">elementPointer</span>(), <span class="dv">2</span>);
            <span class="kw">return</span> <span class="fu">TF_FinishOperation</span>(desc, status);
        }
    }

    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(String<span class="kw">... </span>args) {
        System.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;TensorFlow C library version: &quot;</span> + Pointer.<span class="fu">toString</span>(<span class="fu">TF_Version</span>()));

        Pointer&lt;TF_Graph&gt; graph = <span class="fu">TF_NewGraph</span>();
        Pointer&lt;TF_SessionOptions&gt; options = <span class="fu">TF_NewSessionOptions</span>();
        Pointer&lt;TF_Status&gt; status = <span class="fu">TF_NewStatus</span>();
        Pointer&lt;TF_Session&gt; session = <span class="fu">TF_NewSession</span>(graph, options, status);

        <span class="dt">float</span> in_val_one = <span class="fl">4.</span>0f;
        <span class="dt">float</span> const_two = <span class="fl">2.</span>0f;

        Pointer&lt;TF_Tensor&gt; tensor_in = <span class="fu">TF_AllocateTensor</span>(TF_FLOAT, Pointer.<span class="fu">nullPointer</span>(), <span class="dv">0</span>, Float.<span class="fu">BYTES</span>);
        <span class="fu">TF_TensorData</span>(tensor_in).<span class="fu">cast</span>(NativeTypes.<span class="fu">FLOAT</span>).<span class="fu">set</span>(in_val_one);
        Pointer&lt;TF_Tensor&gt; tensor_const_two = <span class="fu">TF_AllocateTensor</span>(TF_FLOAT, Pointer.<span class="fu">nullPointer</span>(), <span class="dv">0</span>, Float.<span class="fu">BYTES</span>);
        <span class="fu">TF_TensorData</span>(tensor_const_two).<span class="fu">cast</span>(NativeTypes.<span class="fu">FLOAT</span>).<span class="fu">set</span>(const_two);

        <span class="co">// Operations</span>
        Pointer&lt;TF_Operation&gt; feed = <span class="fu">PlaceHolder</span>(graph, status, TF_FLOAT, <span class="st">&quot;feed&quot;</span>);
        Pointer&lt;TF_Operation&gt; two = <span class="fu">ConstValue</span>(graph, status, tensor_const_two, <span class="st">&quot;const&quot;</span>);
        Pointer&lt;TF_Operation&gt; add = <span class="fu">Add</span>(graph, status, feed, two, <span class="st">&quot;add&quot;</span>);


        <span class="kw">try</span> (var s = Scope.<span class="fu">newNativeScope</span>()) {
            var ltPtrTensor = LayoutType.<span class="fu">ofStruct</span>(TF_Tensor.<span class="fu">class</span>).<span class="fu">pointer</span>();

            <span class="co">// Session Inputs</span>
            TF_Output input_operations = s.<span class="fu">allocateStruct</span>(TF_Output.<span class="fu">class</span>);
            input_operations.<span class="fu">oper</span>$<span class="fu">set</span>(feed);
            input_operations.<span class="fu">index</span>$<span class="fu">set</span>(<span class="dv">0</span>);
            Pointer&lt;Pointer&lt;TF_Tensor&gt;&gt; input_tensors = s.<span class="fu">allocate</span>(ltPtrTensor);
            input_tensors.<span class="fu">set</span>(tensor_in);

            <span class="co">// Session Outputs</span>
            TF_Output output_operations = s.<span class="fu">allocateStruct</span>(TF_Output.<span class="fu">class</span>);
            output_operations.<span class="fu">oper</span>$<span class="fu">set</span>(add);
            output_operations.<span class="fu">index</span>$<span class="fu">set</span>(<span class="dv">0</span>);
            Pointer&lt;Pointer&lt;TF_Tensor&gt;&gt; output_tensors = s.<span class="fu">allocate</span>(ltPtrTensor);
            <span class="fu">TF_SessionRun</span>(session, Pointer.<span class="fu">nullPointer</span>(),
                <span class="co">// Inputs</span>
                input_operations.<span class="fu">ptr</span>(), input_tensors, <span class="dv">1</span>,
                <span class="co">// Outputs</span>
                output_operations.<span class="fu">ptr</span>(), output_tensors, <span class="dv">1</span>,
                <span class="co">// Target operations</span>
                Pointer.<span class="fu">nullPointer</span>(), <span class="dv">0</span>, Pointer.<span class="fu">nullPointer</span>(),
                status);

            System.<span class="fu">out</span>.<span class="fu">println</span>(String<span class="fu">.format</span>(<span class="st">&quot;Session Run Status: </span><span class="ch">%d</span><span class="st"> - </span><span class="ch">%s</span><span class="st">&quot;</span>,
                    <span class="fu">TF_GetCode</span>(status), Pointer.<span class="fu">toString</span>(<span class="fu">TF_Message</span>(status))));
            Pointer&lt;TF_Tensor&gt; tensor_out = output_tensors.<span class="fu">get</span>();
            System.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;Output Tensor Type: &quot;</span> + <span class="fu">TF_TensorType</span>(tensor_out));
            <span class="dt">float</span> outval = <span class="fu">TF_TensorData</span>(tensor_out).<span class="fu">cast</span>(NativeTypes.<span class="fu">FLOAT</span>).<span class="fu">get</span>();
            System.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;Output Tensor Value: &quot;</span> + outval);

            <span class="fu">TF_CloseSession</span>(session, status);
            <span class="fu">TF_DeleteSession</span>(session, status);

            <span class="fu">TF_DeleteSessionOptions</span>(options);

            <span class="fu">TF_DeleteGraph</span>(graph);

            <span class="fu">TF_DeleteTensor</span>(tensor_in);
            <span class="fu">TF_DeleteTensor</span>(tensor_out);
            <span class="fu">TF_DeleteTensor</span>(tensor_const_two);

            <span class="fu">TF_DeleteStatus</span>(status);
        }
    }
}</code></pre></div>
<h3 id="compiling-and-running-the-above-tensorflow-sample">Compiling and running the above TensorFlow sample</h3>
<pre class="sh"><code>
javac -cp tf.jar TensorFlowExample.java

java -cp tf.jar:. TensorFlowExample
</code></pre>
</body>
</html>
