<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>panama_foreign</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../make/data/docs-resources/resources/jdk-default.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<nav id="TOC">
<ul>
<li><a href="#using-panama-foreign-jdk">Using Panama “foreign” JDK</a><ul>
<li><a href="#embedding-python-interpreter-in-your-java-program-mac-os">Embedding Python interpreter in your Java program (Mac OS)</a><ul>
<li><a href="#jextract-a-jar-file-for-python.h">jextract a Jar file for Python.h</a></li>
<li><a href="#java-program-that-uses-extracted-python-interface">Java program that uses extracted Python interface</a></li>
<li><a href="#running-the-java-code-that-calls-python-interpreter">Running the Java code that calls Python interpreter</a></li>
</ul></li>
<li><a href="#using-blas-library">Using BLAS library</a><ul>
<li><a href="#installing-openblas-mac-os">Installing OpenBLAS (Mac OS)</a></li>
<li><a href="#installing-openblas-ubuntu-16.04">Installing OpenBLAS (Ubuntu 16.04)</a></li>
<li><a href="#jextracting-cblas.h-macos">jextracting cblas.h (MacOS)</a></li>
<li><a href="#jextracting-cblas.h-ubuntu-16.04">jextracting cblas.h (Ubuntu 16.04)</a></li>
<li><a href="#java-sample-code-that-uses-cblas-library">Java sample code that uses cblas library</a></li>
<li><a href="#compiling-and-running-the-above-cblas-samples">Compiling and running the above cblas samples</a></li>
</ul></li>
<li><a href="#using-lapack-library-ubuntu">Using LAPACK library (Ubuntu)</a><ul>
<li><a href="#jextracting-clapack.h-ubuntu-16.04">jextracting clapack.h (Ubuntu 16.04)</a></li>
<li><a href="#java-sample-code-that-uses-lapack-library">Java sample code that uses LAPACK library</a></li>
<li><a href="#compiling-and-running-the-above-lapack-sample">Compiling and running the above LAPACK sample</a></li>
</ul></li>
<li><a href="#using-libproc-library-to-list-processes-from-java-mac-os">Using libproc library to list processes from Java (Mac OS)</a><ul>
<li><a href="#jextract-a-jar-file-for-libproc.h">jextract a jar file for libproc.h</a></li>
<li><a href="#java-program-that-uses-libproc-to-list-processes">Java program that uses libproc to list processes</a></li>
<li><a href="#running-the-java-code-that-uses-libproc">Running the Java code that uses libproc</a></li>
</ul></li>
<li><a href="#using-readline-library-from-java-code-mac-os">Using readline library from Java code (Mac OS)</a><ul>
<li><a href="#jextract-a-jar-file-for-readline.h">jextract a jar file for readline.h</a></li>
<li><a href="#java-code-that-uses-readline">Java code that uses readline</a></li>
<li><a href="#running-the-java-code-that-uses-readline">Running the java code that uses readline</a></li>
</ul></li>
<li><a href="#using-unistd.h-from-java-code-linux">Using unistd.h from Java code (Linux)</a><ul>
<li><a href="#jextract-a-jar-file-for-unistd.h">jextract a jar file for unistd.h</a></li>
<li><a href="#java-code-that-calls-getpid">Java code that calls getpid</a></li>
<li><a href="#running-the-java-code-that-uses-getpid">Running the Java code that uses getpid</a></li>
</ul></li>
<li><a href="#using-opengl-graphic-library-ubuntu-16.04">Using OpenGL graphic library (Ubuntu 16.04)</a><ul>
<li><a href="#installing-opengl-ubuntu-16.04">Installing OpenGL (Ubuntu 16.04)</a></li>
<li><a href="#jextracting-opengl-ubuntu-16.04">jextracting OpenGL (Ubuntu 16.04)</a></li>
<li><a href="#java-sample-code-that-uses-the-opengl-library">Java sample code that uses the OpenGL library</a></li>
<li><a href="#running-the-java-code-that-uses-opengl">Running the Java code that uses OpenGL</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
<h1 id="using-panama-foreign-jdk">Using Panama “foreign” JDK</h1>
<p>There are two ways to get a panama foreign branch JDK.</p>
<ol type="1">
<li>Locally build “foreign” branch of panama repo <a href="http://hg.openjdk.java.net/panama/dev/">http://hg.openjdk.java.net/panama/dev/</a></li>
<li>Download pre-built panama “foreign” early access binaries from <a href="http://jdk.java.net/panama/">http://jdk.java.net/panama/</a></li>
</ol>
<p>Using foreign function call in Java involves the following three steps:</p>
<ol type="1">
<li>Use <strong>jextract</strong> tool to generate java interface for your C header file(s)</li>
<li>Use <strong>java.foreign</strong> API to create (“bind”) implementation for C header interfaces</li>
<li>Invoke C functions via the jextracted Java interface</li>
</ol>
<h2 id="embedding-python-interpreter-in-your-java-program-mac-os">Embedding Python interpreter in your Java program (Mac OS)</h2>
<h3 id="jextract-a-jar-file-for-python.h">jextract a Jar file for Python.h</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" data-line-number="1"></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="ex">jextract</span> -l python2.7 <span class="dt">\ </span> </a>
<a class="sourceLine" id="cb1-3" data-line-number="3">  <span class="ex">-rpath</span> /System/Library/Frameworks/Python.framework/Versions/2.7/lib <span class="dt">\ </span> </a>
<a class="sourceLine" id="cb1-4" data-line-number="4">  <span class="ex">--exclude-symbols</span> .*_FromFormatV<span class="dt">\|</span>_.*<span class="dt">\|</span>PyOS_vsnprintf<span class="dt">\|</span>.*_VaParse.*<span class="dt">\|</span>.*_VaBuild.*<span class="dt">\|</span>PyBuffer_SizeFromFormat<span class="dt">\|</span>vasprintf<span class="dt">\|</span>vfprintf<span class="dt">\|</span>vprintf<span class="dt">\|</span>vsprintf <span class="dt">\ </span> </a>
<a class="sourceLine" id="cb1-5" data-line-number="5">  <span class="ex">-t</span> org.python <span class="dt">\ </span> </a>
<a class="sourceLine" id="cb1-6" data-line-number="6">  <span class="ex">/usr/include/stdio.h</span> /usr/include/stdlib.h /usr/include/python2.7/Python.h <span class="dt">\ </span> </a>
<a class="sourceLine" id="cb1-7" data-line-number="7">  <span class="ex">-o</span> python.jar</a></code></pre></div>
<h3 id="java-program-that-uses-extracted-python-interface">Java program that uses extracted Python interface</h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb2-1" data-line-number="1"></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="co">// import java.foreign packages</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="kw">import</span><span class="im"> java.foreign.Libraries;</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="kw">import</span><span class="im"> java.foreign.Scope;</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="kw">import</span><span class="im"> java.foreign.memory.Pointer;</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co">// import jextracted python &#39;header&#39; classes</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="kw">import static</span><span class="im"> org.python.Python_h.*;</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="kw">import static</span><span class="im"> org.python.pythonrun_h.*;</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10"></a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="kw">public</span> <span class="kw">class</span> PythonMain {</a>
<a class="sourceLine" id="cb2-12" data-line-number="12">    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {</a>
<a class="sourceLine" id="cb2-13" data-line-number="13">        <span class="fu">Py_Initialize</span>();</a>
<a class="sourceLine" id="cb2-14" data-line-number="14">        <span class="kw">try</span> (Scope s = Scope.<span class="fu">newNativeScope</span>()) {</a>
<a class="sourceLine" id="cb2-15" data-line-number="15">            <span class="fu">PyRun_SimpleStringFlags</span>(s.<span class="fu">allocateCString</span>(</a>
<a class="sourceLine" id="cb2-16" data-line-number="16">                <span class="st">&quot;print(sum([33, 55, 66])); print(&#39;Hello from Python!&#39;)</span><span class="sc">\n</span><span class="st">&quot;</span>),</a>
<a class="sourceLine" id="cb2-17" data-line-number="17">                Pointer.<span class="fu">nullPointer</span>());</a>
<a class="sourceLine" id="cb2-18" data-line-number="18">        }</a>
<a class="sourceLine" id="cb2-19" data-line-number="19">        <span class="fu">Py_Finalize</span>();</a>
<a class="sourceLine" id="cb2-20" data-line-number="20">    }</a>
<a class="sourceLine" id="cb2-21" data-line-number="21">}</a></code></pre></div>
<h3 id="running-the-java-code-that-calls-python-interpreter">Running the Java code that calls Python interpreter</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb3-1" data-line-number="1"></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="ex">javac</span> -cp pythor.jar PythonMain.java</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="ex">java</span> -cp python.jar:. PythonMain</a></code></pre></div>
<h2 id="using-blas-library">Using BLAS library</h2>
<p>BLAS is a popular library that allows fast matrix and vector computation: <a href="http://www.netlib.org/blas/">http://www.netlib.org/blas/</a>.</p>
<h3 id="installing-openblas-mac-os">Installing OpenBLAS (Mac OS)</h3>
<p>On Mac, blas is available as part of the OpenBLAS library: <a href="https://github.com/xianyi/OpenBLAS/wiki">https://github.com/xianyi/OpenBLAS/wiki</a></p>
<p>OpenBLAS is an optimized BLAS library based on GotoBLAS2 1.13 BSD version.</p>
<p>You can install openblas using HomeBrew</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb4-1" data-line-number="1"></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="ex">brew</span> install openblas</a></code></pre></div>
<p>It installs include and lib directories under /usr/local/opt/openblas</p>
<h3 id="installing-openblas-ubuntu-16.04">Installing OpenBLAS (Ubuntu 16.04)</h3>
<p>On Ubuntu, blas is distributed as part of the atlas library: <a href="http://math-atlas.sourceforge.net/">http://math-atlas.sourceforge.net/</a>.</p>
<p>You can install atlas using apt</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb5-1" data-line-number="1"></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="fu">sudo</span> apt-get install libatlas-base-dev</a></code></pre></div>
<p>This command will install include files under <code>/usr/include/atlas</code> and corresponding libraries under <code>/usr/lib/atlas-dev</code>.</p>
<h3 id="jextracting-cblas.h-macos">jextracting cblas.h (MacOS)</h3>
<p>The following command can be used to extract cblas.h on MacOs</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb6-1" data-line-number="1"></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="ex">jextract</span> -C <span class="st">&quot;-D FORCE_OPENBLAS_COMPLEX_STRUCT&quot;</span> <span class="dt">\ </span> </a>
<a class="sourceLine" id="cb6-3" data-line-number="3">  <span class="ex">-L</span> /usr/local/opt/openblas/lib -I /usr/local/opt/openblas <span class="dt">\ </span> </a>
<a class="sourceLine" id="cb6-4" data-line-number="4">  <span class="ex">-l</span> openblas -t blas -infer-rpath /usr/local/opt/openblas/include/cblas.h <span class="dt">\ </span> </a>
<a class="sourceLine" id="cb6-5" data-line-number="5">  <span class="ex">-o</span> cblas.jar</a></code></pre></div>
<p>The FORCE_OPENBLAS_COMPLEX_STRUCT define is needed because jextract does not yet handle C99 <code>_Complex</code> types. The rest of the options are standard ones.</p>
<h3 id="jextracting-cblas.h-ubuntu-16.04">jextracting cblas.h (Ubuntu 16.04)</h3>
<p>The following command can be used to extract cblas.h on Ubuntu</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb7-1" data-line-number="1"></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="ex">jextract</span> -L /usr/lib/atlas-base -I /usr/include/atlas/ \</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">   -l cblas -t blas -infer-rpath \</a>
<a class="sourceLine" id="cb7-4" data-line-number="4">   /usr/include/atlas/cblas.h -o cblas.jar</a></code></pre></div>
<h3 id="java-sample-code-that-uses-cblas-library">Java sample code that uses cblas library</h3>
<div class="sourceCode" id="cb8"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb8-1" data-line-number="1"></a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="kw">import</span><span class="im"> blas.cblas;</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="kw">import static</span><span class="im"> blas.cblas_h.*;</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="kw">import</span><span class="im"> java.foreign.NativeTypes;</span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7"><span class="kw">import</span><span class="im"> java.foreign.Scope;</span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="kw">import</span><span class="im"> java.foreign.memory.Array;</span></a>
<a class="sourceLine" id="cb8-9" data-line-number="9"></a>
<a class="sourceLine" id="cb8-10" data-line-number="10"><span class="kw">public</span> <span class="kw">class</span> TestBlas {</a>
<a class="sourceLine" id="cb8-11" data-line-number="11">   <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {</a>
<a class="sourceLine" id="cb8-12" data-line-number="12">       <span class="at">@cblas</span>.<span class="fu">CBLAS_ORDER</span> <span class="dt">int</span> Layout;</a>
<a class="sourceLine" id="cb8-13" data-line-number="13">       <span class="at">@cblas</span>.<span class="fu">CBLAS_TRANSPOSE</span> <span class="dt">int</span> transa;</a>
<a class="sourceLine" id="cb8-14" data-line-number="14"></a>
<a class="sourceLine" id="cb8-15" data-line-number="15">       <span class="dt">double</span> alpha, beta;</a>
<a class="sourceLine" id="cb8-16" data-line-number="16">       <span class="dt">int</span> m, n, lda, incx, incy, i;</a>
<a class="sourceLine" id="cb8-17" data-line-number="17"></a>
<a class="sourceLine" id="cb8-18" data-line-number="18">       Layout = CblasColMajor;</a>
<a class="sourceLine" id="cb8-19" data-line-number="19">       transa = CblasNoTrans;</a>
<a class="sourceLine" id="cb8-20" data-line-number="20"></a>
<a class="sourceLine" id="cb8-21" data-line-number="21">       m = <span class="dv">4</span>; <span class="co">/* Size of Column ( the number of rows ) */</span></a>
<a class="sourceLine" id="cb8-22" data-line-number="22">       n = <span class="dv">4</span>; <span class="co">/* Size of Row ( the number of columns ) */</span></a>
<a class="sourceLine" id="cb8-23" data-line-number="23">       lda = <span class="dv">4</span>; <span class="co">/* Leading dimension of 5 * 4 matrix is 5 */</span></a>
<a class="sourceLine" id="cb8-24" data-line-number="24">       incx = <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb8-25" data-line-number="25">       incy = <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb8-26" data-line-number="26">       alpha = <span class="dv">1</span>;</a>
<a class="sourceLine" id="cb8-27" data-line-number="27">       beta = <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb8-28" data-line-number="28"></a>
<a class="sourceLine" id="cb8-29" data-line-number="29">       <span class="kw">try</span> (Scope sc = Scope.<span class="fu">newNativeScope</span>()){</a>
<a class="sourceLine" id="cb8-30" data-line-number="30">           <span class="bu">Array</span>&lt;<span class="bu">Double</span>&gt; a = sc.<span class="fu">allocateArray</span>(NativeTypes.<span class="fu">DOUBLE</span>, m * n);</a>
<a class="sourceLine" id="cb8-31" data-line-number="31">           <span class="bu">Array</span>&lt;<span class="bu">Double</span>&gt; x = sc.<span class="fu">allocateArray</span>(NativeTypes.<span class="fu">DOUBLE</span>, n);</a>
<a class="sourceLine" id="cb8-32" data-line-number="32">           <span class="bu">Array</span>&lt;<span class="bu">Double</span>&gt; y = sc.<span class="fu">allocateArray</span>(NativeTypes.<span class="fu">DOUBLE</span>, n);</a>
<a class="sourceLine" id="cb8-33" data-line-number="33">           <span class="co">/* The elements of the first column */</span></a>
<a class="sourceLine" id="cb8-34" data-line-number="34">           a.<span class="fu">set</span>(<span class="dv">0</span>, <span class="fl">1.0</span>);</a>
<a class="sourceLine" id="cb8-35" data-line-number="35">           a.<span class="fu">set</span>(<span class="dv">1</span>, <span class="fl">2.0</span>);</a>
<a class="sourceLine" id="cb8-36" data-line-number="36">           a.<span class="fu">set</span>(<span class="dv">2</span>, <span class="fl">3.0</span>);</a>
<a class="sourceLine" id="cb8-37" data-line-number="37">           a.<span class="fu">set</span>(<span class="dv">3</span>, <span class="fl">4.0</span>);</a>
<a class="sourceLine" id="cb8-38" data-line-number="38">           <span class="co">/* The elements of the second column */</span></a>
<a class="sourceLine" id="cb8-39" data-line-number="39">           a.<span class="fu">set</span>(m, <span class="fl">1.0</span>);</a>
<a class="sourceLine" id="cb8-40" data-line-number="40">           a.<span class="fu">set</span>(m + <span class="dv">1</span>, <span class="fl">1.0</span>);</a>
<a class="sourceLine" id="cb8-41" data-line-number="41">           a.<span class="fu">set</span>(m + <span class="dv">2</span>, <span class="fl">1.0</span>);</a>
<a class="sourceLine" id="cb8-42" data-line-number="42">           a.<span class="fu">set</span>(m + <span class="dv">3</span>, <span class="fl">1.0</span>);</a>
<a class="sourceLine" id="cb8-43" data-line-number="43">           <span class="co">/* The elements of the third column */</span></a>
<a class="sourceLine" id="cb8-44" data-line-number="44">           a.<span class="fu">set</span>(m * <span class="dv">2</span>, <span class="fl">3.0</span>);</a>
<a class="sourceLine" id="cb8-45" data-line-number="45">           a.<span class="fu">set</span>(m * <span class="dv">2</span> + <span class="dv">1</span>, <span class="fl">4.0</span>);</a>
<a class="sourceLine" id="cb8-46" data-line-number="46">           a.<span class="fu">set</span>(m * <span class="dv">2</span> + <span class="dv">2</span>, <span class="fl">5.0</span>);</a>
<a class="sourceLine" id="cb8-47" data-line-number="47">           a.<span class="fu">set</span>(m * <span class="dv">2</span> + <span class="dv">3</span>, <span class="fl">6.0</span>);</a>
<a class="sourceLine" id="cb8-48" data-line-number="48">           <span class="co">/* The elements of the fourth column */</span></a>
<a class="sourceLine" id="cb8-49" data-line-number="49">           a.<span class="fu">set</span>(m * <span class="dv">3</span>, <span class="fl">5.0</span>);</a>
<a class="sourceLine" id="cb8-50" data-line-number="50">           a.<span class="fu">set</span>(m * <span class="dv">3</span> + <span class="dv">1</span>, <span class="fl">6.0</span>);</a>
<a class="sourceLine" id="cb8-51" data-line-number="51">           a.<span class="fu">set</span>(m * <span class="dv">3</span> + <span class="dv">2</span>, <span class="fl">7.0</span>);</a>
<a class="sourceLine" id="cb8-52" data-line-number="52">           a.<span class="fu">set</span>(m * <span class="dv">3</span> + <span class="dv">3</span>, <span class="fl">8.0</span>);</a>
<a class="sourceLine" id="cb8-53" data-line-number="53">           <span class="co">/* The elemetns of x and y */</span></a>
<a class="sourceLine" id="cb8-54" data-line-number="54">           x.<span class="fu">set</span>(<span class="dv">0</span>, <span class="fl">1.0</span>);</a>
<a class="sourceLine" id="cb8-55" data-line-number="55">           x.<span class="fu">set</span>(<span class="dv">1</span>, <span class="fl">2.0</span>);</a>
<a class="sourceLine" id="cb8-56" data-line-number="56">           x.<span class="fu">set</span>(<span class="dv">2</span>, <span class="fl">1.0</span>);</a>
<a class="sourceLine" id="cb8-57" data-line-number="57">           x.<span class="fu">set</span>(<span class="dv">3</span>, <span class="fl">1.0</span>);</a>
<a class="sourceLine" id="cb8-58" data-line-number="58">           y.<span class="fu">set</span>(<span class="dv">0</span>, <span class="fl">0.0</span>);</a>
<a class="sourceLine" id="cb8-59" data-line-number="59">           y.<span class="fu">set</span>(<span class="dv">1</span>, <span class="fl">0.0</span>);</a>
<a class="sourceLine" id="cb8-60" data-line-number="60">           y.<span class="fu">set</span>(<span class="dv">2</span>, <span class="fl">0.0</span>);</a>
<a class="sourceLine" id="cb8-61" data-line-number="61">           y.<span class="fu">set</span>(<span class="dv">3</span>, <span class="fl">0.0</span>);</a>
<a class="sourceLine" id="cb8-62" data-line-number="62"></a>
<a class="sourceLine" id="cb8-63" data-line-number="63">           <span class="fu">cblas_dgemv</span>(Layout, transa, m, n, alpha, a.<span class="fu">elementPointer</span>(), lda, x.<span class="fu">elementPointer</span>(), incx, beta,</a>
<a class="sourceLine" id="cb8-64" data-line-number="64">                   y.<span class="fu">elementPointer</span>(), incy);</a>
<a class="sourceLine" id="cb8-65" data-line-number="65">           <span class="co">/* Print y */</span></a>
<a class="sourceLine" id="cb8-66" data-line-number="66">           <span class="kw">for</span> (i = <span class="dv">0</span>; i &lt; n; i++)</a>
<a class="sourceLine" id="cb8-67" data-line-number="67">               <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">print</span>(<span class="bu">String</span><span class="fu">.format</span>(<span class="st">&quot; y</span><span class="sc">%d</span><span class="st"> = </span><span class="sc">%f\n</span><span class="st">&quot;</span>, i, y.<span class="fu">get</span>(i)));</a>
<a class="sourceLine" id="cb8-68" data-line-number="68">       }</a>
<a class="sourceLine" id="cb8-69" data-line-number="69">   }</a>
<a class="sourceLine" id="cb8-70" data-line-number="70">}</a></code></pre></div>
<h3 id="compiling-and-running-the-above-cblas-samples">Compiling and running the above cblas samples</h3>
<div class="sourceCode" id="cb9"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb9-1" data-line-number="1"></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="ex">javac</span> -cp cblas.jar TestBlas.java</a>
<a class="sourceLine" id="cb9-3" data-line-number="3"></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="ex">java</span> -cp cblas.jar:. TestBlas</a></code></pre></div>
<h2 id="using-lapack-library-ubuntu">Using LAPACK library (Ubuntu)</h2>
<p>On Ubuntu, the same steps used to install the blas (via atlas) library also install headers and libraries for the LAPACK library, a linear algebra computation library built on top of blas.</p>
<h3 id="jextracting-clapack.h-ubuntu-16.04">jextracting clapack.h (Ubuntu 16.04)</h3>
<p>The following command can be used to extract the LAPACK header:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb10-1" data-line-number="1"></a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="ex">jextract</span> -L /usr/lib/atlas-base/atlas -I /usr/include/atlas/ \</a>
<a class="sourceLine" id="cb10-3" data-line-number="3">   -l lapack -t lapack -infer-rpath /usr/include/atlas/clapack.h -o clapack.jar</a></code></pre></div>
<h3 id="java-sample-code-that-uses-lapack-library">Java sample code that uses LAPACK library</h3>
<div class="sourceCode" id="cb11"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw">import</span><span class="im"> java.foreign.NativeTypes;</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="kw">import</span><span class="im"> java.foreign.Scope;</span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="kw">import</span><span class="im"> java.foreign.memory.Array;</span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4"></a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="kw">import static</span><span class="im"> lapack.clapack_h.*;</span></a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="kw">import static</span><span class="im"> lapack.cblas_h.*;</span></a>
<a class="sourceLine" id="cb11-7" data-line-number="7"></a>
<a class="sourceLine" id="cb11-8" data-line-number="8"><span class="kw">public</span> <span class="kw">class</span> TestLapack {</a>
<a class="sourceLine" id="cb11-9" data-line-number="9">    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {</a>
<a class="sourceLine" id="cb11-10" data-line-number="10"></a>
<a class="sourceLine" id="cb11-11" data-line-number="11">        <span class="co">/* Locals */</span></a>
<a class="sourceLine" id="cb11-12" data-line-number="12">        <span class="kw">try</span> (Scope sc = Scope.<span class="fu">newNativeScope</span>()) {</a>
<a class="sourceLine" id="cb11-13" data-line-number="13">            <span class="bu">Array</span>&lt;<span class="bu">Double</span>&gt; A = sc.<span class="fu">allocateArray</span>(NativeTypes.<span class="fu">DOUBLE</span>, <span class="kw">new</span> <span class="dt">double</span>[]{</a>
<a class="sourceLine" id="cb11-14" data-line-number="14">                    <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">3</span></a>
<a class="sourceLine" id="cb11-15" data-line-number="15">            });</a>
<a class="sourceLine" id="cb11-16" data-line-number="16">            <span class="bu">Array</span>&lt;<span class="bu">Double</span>&gt; b = sc.<span class="fu">allocateArray</span>(NativeTypes.<span class="fu">DOUBLE</span>, <span class="kw">new</span> <span class="dt">double</span>[]{</a>
<a class="sourceLine" id="cb11-17" data-line-number="17">                    <span class="dv">-10</span>, <span class="dv">12</span>, <span class="dv">14</span>, <span class="dv">16</span>, <span class="dv">18</span>, <span class="dv">-3</span>, <span class="dv">14</span>, <span class="dv">12</span>, <span class="dv">16</span>, <span class="dv">16</span></a>
<a class="sourceLine" id="cb11-18" data-line-number="18">            });</a>
<a class="sourceLine" id="cb11-19" data-line-number="19">            <span class="dt">int</span> info, m, n, lda, ldb, nrhs;</a>
<a class="sourceLine" id="cb11-20" data-line-number="20"></a>
<a class="sourceLine" id="cb11-21" data-line-number="21">            <span class="co">/* Initialization */</span></a>
<a class="sourceLine" id="cb11-22" data-line-number="22">            m = <span class="dv">5</span>;</a>
<a class="sourceLine" id="cb11-23" data-line-number="23">            n = <span class="dv">3</span>;</a>
<a class="sourceLine" id="cb11-24" data-line-number="24">            nrhs = <span class="dv">2</span>;</a>
<a class="sourceLine" id="cb11-25" data-line-number="25">            lda = <span class="dv">5</span>;</a>
<a class="sourceLine" id="cb11-26" data-line-number="26">            ldb = <span class="dv">5</span>;</a>
<a class="sourceLine" id="cb11-27" data-line-number="27"></a>
<a class="sourceLine" id="cb11-28" data-line-number="28">            <span class="co">/* Print Entry Matrix */</span></a>
<a class="sourceLine" id="cb11-29" data-line-number="29">            <span class="fu">print_matrix_colmajor</span>(<span class="st">&quot;Entry Matrix A&quot;</span>, m, n, A, lda );</a>
<a class="sourceLine" id="cb11-30" data-line-number="30">            <span class="co">/* Print Right Rand Side */</span></a>
<a class="sourceLine" id="cb11-31" data-line-number="31">            <span class="fu">print_matrix_colmajor</span>(<span class="st">&quot;Right Hand Side b&quot;</span>, n, nrhs, b, ldb );</a>
<a class="sourceLine" id="cb11-32" data-line-number="32">            <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>();</a>
<a class="sourceLine" id="cb11-33" data-line-number="33"></a>
<a class="sourceLine" id="cb11-34" data-line-number="34">            <span class="co">/* Executable statements */</span></a>
<a class="sourceLine" id="cb11-35" data-line-number="35">            <span class="co">//            printf( &quot;LAPACKE_dgels (col-major, high-level) Example Program Results\n&quot; );</span></a>
<a class="sourceLine" id="cb11-36" data-line-number="36">            <span class="co">/* Solve least squares problem*/</span></a>
<a class="sourceLine" id="cb11-37" data-line-number="37">            info = <span class="fu">clapack_dgels</span>(CblasColMajor, CblasNoTrans, m, n, nrhs, A.<span class="fu">elementPointer</span>(), lda, b.<span class="fu">elementPointer</span>(), ldb);</a>
<a class="sourceLine" id="cb11-38" data-line-number="38"></a>
<a class="sourceLine" id="cb11-39" data-line-number="39">            <span class="co">/* Print Solution */</span></a>
<a class="sourceLine" id="cb11-40" data-line-number="40">            <span class="fu">print_matrix_colmajor</span>(<span class="st">&quot;Solution&quot;</span>, n, nrhs, b, ldb );</a>
<a class="sourceLine" id="cb11-41" data-line-number="41">            <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>();</a>
<a class="sourceLine" id="cb11-42" data-line-number="42">            <span class="bu">System</span>.<span class="fu">exit</span>(info);</a>
<a class="sourceLine" id="cb11-43" data-line-number="43">        }</a>
<a class="sourceLine" id="cb11-44" data-line-number="44">    }</a>
<a class="sourceLine" id="cb11-45" data-line-number="45"></a>
<a class="sourceLine" id="cb11-46" data-line-number="46">    <span class="dt">static</span> <span class="dt">void</span> <span class="fu">print_matrix_colmajor</span>(<span class="bu">String</span> msg, <span class="dt">int</span> m, <span class="dt">int</span> n, <span class="bu">Array</span>&lt;<span class="bu">Double</span>&gt; mat, <span class="dt">int</span> ldm) {</a>
<a class="sourceLine" id="cb11-47" data-line-number="47">        <span class="dt">int</span> i, j;</a>
<a class="sourceLine" id="cb11-48" data-line-number="48">        <span class="bu">System</span>.<span class="fu">out.printf</span>(<span class="st">&quot;</span><span class="sc">\n</span><span class="st"> </span><span class="sc">%s\n</span><span class="st">&quot;</span>, msg);</a>
<a class="sourceLine" id="cb11-49" data-line-number="49"></a>
<a class="sourceLine" id="cb11-50" data-line-number="50">        <span class="kw">for</span>( i = <span class="dv">0</span>; i &lt; m; i++ ) {</a>
<a class="sourceLine" id="cb11-51" data-line-number="51">            <span class="kw">for</span>( j = <span class="dv">0</span>; j &lt; n; j++ ) <span class="bu">System</span>.<span class="fu">out.printf</span>(<span class="st">&quot; </span><span class="sc">%6.2f</span><span class="st">&quot;</span>, mat.<span class="fu">get</span>(i+j*ldm));</a>
<a class="sourceLine" id="cb11-52" data-line-number="52">            <span class="bu">System</span>.<span class="fu">out.printf</span>( <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span> );</a>
<a class="sourceLine" id="cb11-53" data-line-number="53">        }</a>
<a class="sourceLine" id="cb11-54" data-line-number="54">    }</a>
<a class="sourceLine" id="cb11-55" data-line-number="55">}</a></code></pre></div>
<h3 id="compiling-and-running-the-above-lapack-sample">Compiling and running the above LAPACK sample</h3>
<div class="sourceCode" id="cb12"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb12-1" data-line-number="1"></a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="ex">javac</span> -cp clapack.jar TestLapack.java</a>
<a class="sourceLine" id="cb12-3" data-line-number="3"></a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="ex">java</span> -cp clapack.jar:. TestLapack</a></code></pre></div>
<h2 id="using-libproc-library-to-list-processes-from-java-mac-os">Using libproc library to list processes from Java (Mac OS)</h2>
<h3 id="jextract-a-jar-file-for-libproc.h">jextract a jar file for libproc.h</h3>
<p>jextract -t org.unix -lproc -rpath /usr/lib -o libproc.jar /usr/include/libproc.h</p>
<h3 id="java-program-that-uses-libproc-to-list-processes">Java program that uses libproc to list processes</h3>
<div class="sourceCode" id="cb13"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb13-1" data-line-number="1"></a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="kw">import</span><span class="im"> java.foreign.*;</span></a>
<a class="sourceLine" id="cb13-3" data-line-number="3"><span class="kw">import</span><span class="im"> java.foreign.memory.*;</span></a>
<a class="sourceLine" id="cb13-4" data-line-number="4"><span class="kw">import static</span><span class="im"> org.unix.libproc_h.*;</span></a>
<a class="sourceLine" id="cb13-5" data-line-number="5"></a>
<a class="sourceLine" id="cb13-6" data-line-number="6"><span class="kw">public</span> <span class="kw">class</span> LibprocMain {</a>
<a class="sourceLine" id="cb13-7" data-line-number="7">    <span class="kw">private</span> <span class="dt">static</span> <span class="dt">final</span> <span class="dt">int</span> NAME_BUF_MAX = <span class="dv">256</span>;</a>
<a class="sourceLine" id="cb13-8" data-line-number="8"></a>
<a class="sourceLine" id="cb13-9" data-line-number="9">    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {</a>
<a class="sourceLine" id="cb13-10" data-line-number="10">        <span class="co">// Scope for native allocations</span></a>
<a class="sourceLine" id="cb13-11" data-line-number="11">        <span class="kw">try</span> (Scope s = Scope.<span class="fu">newNativeScope</span>()) {</a>
<a class="sourceLine" id="cb13-12" data-line-number="12">            <span class="co">// get the number of processes</span></a>
<a class="sourceLine" id="cb13-13" data-line-number="13">            <span class="dt">int</span> numPids = <span class="fu">proc_listallpids</span>(Pointer.<span class="fu">nullPointer</span>(), <span class="dv">0</span>);</a>
<a class="sourceLine" id="cb13-14" data-line-number="14">            <span class="co">// allocate an array</span></a>
<a class="sourceLine" id="cb13-15" data-line-number="15">            <span class="bu">Array</span>&lt;<span class="bu">Integer</span>&gt; pids = s.<span class="fu">allocateArray</span>(NativeTypes.<span class="fu">INT32</span>, numPids);</a>
<a class="sourceLine" id="cb13-16" data-line-number="16">            <span class="co">// list all the pids into the native array</span></a>
<a class="sourceLine" id="cb13-17" data-line-number="17">            <span class="fu">proc_listallpids</span>(pids.<span class="fu">elementPointer</span>(), numPids);</a>
<a class="sourceLine" id="cb13-18" data-line-number="18">            <span class="co">// convert native array to java array</span></a>
<a class="sourceLine" id="cb13-19" data-line-number="19">            <span class="dt">int</span>[] jpids = pids.<span class="fu">toArray</span>(num -&gt; <span class="kw">new</span> <span class="dt">int</span>[num]);</a>
<a class="sourceLine" id="cb13-20" data-line-number="20">            <span class="co">// buffer for process name</span></a>
<a class="sourceLine" id="cb13-21" data-line-number="21">            Pointer&lt;<span class="bu">Byte</span>&gt; nameBuf = s.<span class="fu">allocate</span>(NativeTypes.<span class="fu">INT8</span>, NAME_BUF_MAX);</a>
<a class="sourceLine" id="cb13-22" data-line-number="22">            <span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; jpids.<span class="fu">length</span>; i++) {</a>
<a class="sourceLine" id="cb13-23" data-line-number="23">                <span class="dt">int</span> pid = jpids[i];</a>
<a class="sourceLine" id="cb13-24" data-line-number="24">                <span class="co">// get the process name</span></a>
<a class="sourceLine" id="cb13-25" data-line-number="25">                <span class="fu">proc_name</span>(pid, nameBuf, NAME_BUF_MAX);</a>
<a class="sourceLine" id="cb13-26" data-line-number="26">                <span class="bu">String</span> procName = Pointer.<span class="fu">toString</span>(nameBuf);</a>
<a class="sourceLine" id="cb13-27" data-line-number="27">                <span class="co">// print pid and process name</span></a>
<a class="sourceLine" id="cb13-28" data-line-number="28">                <span class="bu">System</span>.<span class="fu">out.printf</span>(<span class="st">&quot;</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%s\n</span><span class="st">&quot;</span>, pid, procName);</a>
<a class="sourceLine" id="cb13-29" data-line-number="29">            }</a>
<a class="sourceLine" id="cb13-30" data-line-number="30">        }</a>
<a class="sourceLine" id="cb13-31" data-line-number="31">    }</a>
<a class="sourceLine" id="cb13-32" data-line-number="32">}</a></code></pre></div>
<h3 id="running-the-java-code-that-uses-libproc">Running the Java code that uses libproc</h3>
<div class="sourceCode" id="cb14"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb14-1" data-line-number="1"></a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="ex">javac</span> -cp libproc.jar LibprocMain.java</a>
<a class="sourceLine" id="cb14-3" data-line-number="3"></a>
<a class="sourceLine" id="cb14-4" data-line-number="4"><span class="ex">java</span> -cp libproc.jar:. LibprocMain</a></code></pre></div>
<h2 id="using-readline-library-from-java-code-mac-os">Using readline library from Java code (Mac OS)</h2>
<h3 id="jextract-a-jar-file-for-readline.h">jextract a jar file for readline.h</h3>
<div class="sourceCode" id="cb15"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb15-1" data-line-number="1"></a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="ex">jextract</span> -l readline -rpath /usr/local/opt/readline/lib/ <span class="dt">\ </span> </a>
<a class="sourceLine" id="cb15-3" data-line-number="3">    <span class="ex">-t</span> org.unix <span class="dt">\ </span> </a>
<a class="sourceLine" id="cb15-4" data-line-number="4">    <span class="ex">/usr/include/readline/readline.h</span> /usr/include/_stdio.h <span class="dt">\ </span> </a>
<a class="sourceLine" id="cb15-5" data-line-number="5">    <span class="ex">--exclude-symbol</span> readline_echoing_p -o readline.jar</a></code></pre></div>
<h3 id="java-code-that-uses-readline">Java code that uses readline</h3>
<div class="sourceCode" id="cb16"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb16-1" data-line-number="1"></a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="kw">import</span><span class="im"> java.foreign.*;</span></a>
<a class="sourceLine" id="cb16-3" data-line-number="3"><span class="kw">import</span><span class="im"> java.foreign.memory.*;</span></a>
<a class="sourceLine" id="cb16-4" data-line-number="4"><span class="kw">import static</span><span class="im"> org.unix.readline_h.*;</span></a>
<a class="sourceLine" id="cb16-5" data-line-number="5"></a>
<a class="sourceLine" id="cb16-6" data-line-number="6"><span class="kw">public</span> <span class="kw">class</span> Readline {</a>
<a class="sourceLine" id="cb16-7" data-line-number="7">    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {</a>
<a class="sourceLine" id="cb16-8" data-line-number="8">        <span class="co">// Scope for native allocations</span></a>
<a class="sourceLine" id="cb16-9" data-line-number="9">        <span class="kw">try</span> (Scope s = Scope.<span class="fu">newNativeScope</span>()) {</a>
<a class="sourceLine" id="cb16-10" data-line-number="10">            <span class="co">// allocate C memory initialized with Java string content</span></a>
<a class="sourceLine" id="cb16-11" data-line-number="11">            var pstr = s.<span class="fu">allocateCString</span>(<span class="st">&quot;name? &quot;</span>);</a>
<a class="sourceLine" id="cb16-12" data-line-number="12"></a>
<a class="sourceLine" id="cb16-13" data-line-number="13">            <span class="co">// call &quot;readline&quot; API</span></a>
<a class="sourceLine" id="cb16-14" data-line-number="14">            var p = <span class="fu">readline</span>(pstr);</a>
<a class="sourceLine" id="cb16-15" data-line-number="15"></a>
<a class="sourceLine" id="cb16-16" data-line-number="16">            <span class="co">// print char* as is</span></a>
<a class="sourceLine" id="cb16-17" data-line-number="17">            <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(p);</a>
<a class="sourceLine" id="cb16-18" data-line-number="18">            <span class="co">// convert char* ptr from readline as Java String &amp; print it</span></a>
<a class="sourceLine" id="cb16-19" data-line-number="19">            <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(Pointer.<span class="fu">toString</span>(p));</a>
<a class="sourceLine" id="cb16-20" data-line-number="20">        }</a>
<a class="sourceLine" id="cb16-21" data-line-number="21">    }</a>
<a class="sourceLine" id="cb16-22" data-line-number="22">}</a></code></pre></div>
<h3 id="running-the-java-code-that-uses-readline">Running the java code that uses readline</h3>
<pre><code>
javac -cp readline.jar Readline.java

java -cp readline.jar:. Readline
</code></pre>
<h2 id="using-unistd.h-from-java-code-linux">Using unistd.h from Java code (Linux)</h2>
<h3 id="jextract-a-jar-file-for-unistd.h">jextract a jar file for unistd.h</h3>
<div class="sourceCode" id="cb18"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb18-1" data-line-number="1"></a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="ex">jextract</span> /usr/include/unistd.h -t org.unix -o unistd.jar</a></code></pre></div>
<h3 id="java-code-that-calls-getpid">Java code that calls getpid</h3>
<div class="sourceCode" id="cb19"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb19-1" data-line-number="1"></a>
<a class="sourceLine" id="cb19-2" data-line-number="2"><span class="kw">import</span><span class="im"> java.foreign.*;</span></a>
<a class="sourceLine" id="cb19-3" data-line-number="3"><span class="kw">import</span><span class="im"> java.lang.invoke.*;</span></a>
<a class="sourceLine" id="cb19-4" data-line-number="4"><span class="kw">import</span><span class="im"> org.unix.unistd;</span></a>
<a class="sourceLine" id="cb19-5" data-line-number="5"></a>
<a class="sourceLine" id="cb19-6" data-line-number="6"></a>
<a class="sourceLine" id="cb19-7" data-line-number="7"><span class="kw">public</span> <span class="kw">class</span> Getpid {</a>
<a class="sourceLine" id="cb19-8" data-line-number="8">    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {</a>
<a class="sourceLine" id="cb19-9" data-line-number="9">        <span class="co">// bind unistd interface</span></a>
<a class="sourceLine" id="cb19-10" data-line-number="10">        var u = Libraries.<span class="fu">bind</span>(MethodHandles.<span class="fu">lookup</span>(), unistd.<span class="fu">class</span>);</a>
<a class="sourceLine" id="cb19-11" data-line-number="11">        <span class="co">// call getpid from the unistd.h</span></a>
<a class="sourceLine" id="cb19-12" data-line-number="12">        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(u.<span class="fu">getpid</span>());</a>
<a class="sourceLine" id="cb19-13" data-line-number="13">        <span class="co">// check process id from Java API!</span></a>
<a class="sourceLine" id="cb19-14" data-line-number="14">        <span class="bu">System</span>.<span class="fu">out</span>.<span class="fu">println</span>(ProcessHandle.<span class="fu">current</span>().<span class="fu">pid</span>());</a>
<a class="sourceLine" id="cb19-15" data-line-number="15">    }</a>
<a class="sourceLine" id="cb19-16" data-line-number="16">}</a></code></pre></div>
<h3 id="running-the-java-code-that-uses-getpid">Running the Java code that uses getpid</h3>
<div class="sourceCode" id="cb20"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb20-1" data-line-number="1"></a>
<a class="sourceLine" id="cb20-2" data-line-number="2"><span class="ex">javac</span> -cp unistd.jar Getpid.java</a>
<a class="sourceLine" id="cb20-3" data-line-number="3"></a>
<a class="sourceLine" id="cb20-4" data-line-number="4"><span class="ex">java</span> -cp unistd.jar:. Getpid</a></code></pre></div>
<h2 id="using-opengl-graphic-library-ubuntu-16.04">Using OpenGL graphic library (Ubuntu 16.04)</h2>
<p>OpenGL is a popular portable graphic library: <a href="https://www.opengl.org/">https://www.opengl.org/</a></p>
<h3 id="installing-opengl-ubuntu-16.04">Installing OpenGL (Ubuntu 16.04)</h3>
<p>Installing relevant OpenGL headers and libraries can be a bit tricky, as it depends on what graphic card is installed on the target platform. The following instruction assume that the standard version of OpenGL is used (e.g. mesa), rather than a proprietary one (Nvidia or AMD), although the changes to get these working are rather small.</p>
<p>OpenGL is always coupled with a bunch of other libraries, namely GLU and glut. You can install all those libraries using <code>apt</code>, as follows:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb21-1" data-line-number="1"></a>
<a class="sourceLine" id="cb21-2" data-line-number="2"><span class="fu">sudo</span> apt-get install libgl1-mesa-dev libglu1-mesa-dev freeglut3-dev</a></code></pre></div>
<p>If the installation was successful, OpenGL headers can be found under <code>/usr/include/GL</code>, while libraries can be found in the folder <code>/usr/lib/x86_64-linux-gnu/</code>.</p>
<h3 id="jextracting-opengl-ubuntu-16.04">jextracting OpenGL (Ubuntu 16.04)</h3>
<p>To extract the opengl libraries the following command suffices:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb22-1" data-line-number="1"></a>
<a class="sourceLine" id="cb22-2" data-line-number="2"><span class="ex">jextract</span> -L /usr/lib/x86_64-linux-gnu  -l glut -l GLU -l GL --infer-rpath -t opengl -o opengl.jar /usr/include/GL/glut.h</a></code></pre></div>
<p>Since glut depends on the other libraries (GLU and GL), it is not necessary to give additional headers to jextract.</p>
<h3 id="java-sample-code-that-uses-the-opengl-library">Java sample code that uses the OpenGL library</h3>
<div class="sourceCode" id="cb23"><pre class="sourceCode java"><code class="sourceCode java"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="kw">import</span><span class="im"> java.foreign.Libraries;</span></a>
<a class="sourceLine" id="cb23-2" data-line-number="2"><span class="kw">import</span><span class="im"> java.foreign.NativeTypes;</span></a>
<a class="sourceLine" id="cb23-3" data-line-number="3"><span class="kw">import</span><span class="im"> java.foreign.Scope;</span></a>
<a class="sourceLine" id="cb23-4" data-line-number="4"><span class="kw">import</span><span class="im"> java.foreign.memory.Array;</span></a>
<a class="sourceLine" id="cb23-5" data-line-number="5"><span class="kw">import</span><span class="im"> java.foreign.memory.Pointer;</span></a>
<a class="sourceLine" id="cb23-6" data-line-number="6"><span class="kw">import</span><span class="im"> java.lang.invoke.MethodHandles;</span></a>
<a class="sourceLine" id="cb23-7" data-line-number="7"></a>
<a class="sourceLine" id="cb23-8" data-line-number="8"><span class="kw">import</span><span class="im"> opengl.*;</span></a>
<a class="sourceLine" id="cb23-9" data-line-number="9"></a>
<a class="sourceLine" id="cb23-10" data-line-number="10"><span class="kw">import</span><span class="im"> javax.imageio.ImageIO;</span></a>
<a class="sourceLine" id="cb23-11" data-line-number="11"></a>
<a class="sourceLine" id="cb23-12" data-line-number="12"><span class="kw">public</span> <span class="kw">class</span> Teapot {</a>
<a class="sourceLine" id="cb23-13" data-line-number="13">    <span class="dt">static</span> gl gl = Libraries.<span class="fu">bind</span>(MethodHandles.<span class="fu">lookup</span>(), gl.<span class="fu">class</span>);</a>
<a class="sourceLine" id="cb23-14" data-line-number="14">    <span class="dt">static</span> freeglut_std glut = Libraries.<span class="fu">bind</span>(MethodHandles.<span class="fu">lookup</span>(), freeglut_std.<span class="fu">class</span>);</a>
<a class="sourceLine" id="cb23-15" data-line-number="15"></a>
<a class="sourceLine" id="cb23-16" data-line-number="16">    <span class="dt">float</span> rot = <span class="dv">0</span>;</a>
<a class="sourceLine" id="cb23-17" data-line-number="17"></a>
<a class="sourceLine" id="cb23-18" data-line-number="18">    <span class="fu">Teapot</span>(Scope sc) {</a>
<a class="sourceLine" id="cb23-19" data-line-number="19">        <span class="co">// Misc Parameters</span></a>
<a class="sourceLine" id="cb23-20" data-line-number="20">        <span class="bu">Array</span>&lt;<span class="bu">Float</span>&gt; pos = sc.<span class="fu">allocateArray</span>(NativeTypes.<span class="fu">FLOAT</span>, <span class="kw">new</span> <span class="dt">float</span>[] {<span class="fl">0.0f</span>, <span class="fl">15.0f</span>, <span class="fl">-15.0f</span>, <span class="dv">0</span>});</a>
<a class="sourceLine" id="cb23-21" data-line-number="21">        <span class="bu">Array</span>&lt;<span class="bu">Float</span>&gt; spec = sc.<span class="fu">allocateArray</span>(NativeTypes.<span class="fu">FLOAT</span>, <span class="kw">new</span> <span class="dt">float</span>[] {<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>});</a>
<a class="sourceLine" id="cb23-22" data-line-number="22">        <span class="bu">Array</span>&lt;<span class="bu">Float</span>&gt; shini = sc.<span class="fu">allocateArray</span>(NativeTypes.<span class="fu">FLOAT</span>, <span class="kw">new</span> <span class="dt">float</span>[] {<span class="dv">113</span>});</a>
<a class="sourceLine" id="cb23-23" data-line-number="23"></a>
<a class="sourceLine" id="cb23-24" data-line-number="24">        <span class="co">// Reset Background</span></a>
<a class="sourceLine" id="cb23-25" data-line-number="25">        gl.<span class="fu">glClearColor</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>);</a>
<a class="sourceLine" id="cb23-26" data-line-number="26"></a>
<a class="sourceLine" id="cb23-27" data-line-number="27">        <span class="co">// Setup Lighting</span></a>
<a class="sourceLine" id="cb23-28" data-line-number="28">        gl.<span class="fu">glShadeModel</span>(gl.<span class="fu">GL_SMOOTH</span>());</a>
<a class="sourceLine" id="cb23-29" data-line-number="29">        gl.<span class="fu">glLightfv</span>(gl.<span class="fu">GL_LIGHT0</span>(), gl.<span class="fu">GL_POSITION</span>(), pos.<span class="fu">elementPointer</span>());</a>
<a class="sourceLine" id="cb23-30" data-line-number="30">        gl.<span class="fu">glLightfv</span>(gl.<span class="fu">GL_LIGHT0</span>(), gl.<span class="fu">GL_AMBIENT</span>(), spec.<span class="fu">elementPointer</span>());</a>
<a class="sourceLine" id="cb23-31" data-line-number="31">        gl.<span class="fu">glLightfv</span>(gl.<span class="fu">GL_LIGHT0</span>(), gl.<span class="fu">GL_DIFFUSE</span>(), spec.<span class="fu">elementPointer</span>());</a>
<a class="sourceLine" id="cb23-32" data-line-number="32">        gl.<span class="fu">glLightfv</span>(gl.<span class="fu">GL_LIGHT0</span>(), gl.<span class="fu">GL_SPECULAR</span>(), spec.<span class="fu">elementPointer</span>());</a>
<a class="sourceLine" id="cb23-33" data-line-number="33">        gl.<span class="fu">glMaterialfv</span>(gl.<span class="fu">GL_FRONT</span>(), gl.<span class="fu">GL_SHININESS</span>(), shini.<span class="fu">elementPointer</span>());</a>
<a class="sourceLine" id="cb23-34" data-line-number="34">        gl.<span class="fu">glEnable</span>(gl.<span class="fu">GL_LIGHTING</span>());</a>
<a class="sourceLine" id="cb23-35" data-line-number="35">        gl.<span class="fu">glEnable</span>(gl.<span class="fu">GL_LIGHT0</span>());</a>
<a class="sourceLine" id="cb23-36" data-line-number="36">        gl.<span class="fu">glEnable</span>(gl.<span class="fu">GL_DEPTH_TEST</span>());</a>
<a class="sourceLine" id="cb23-37" data-line-number="37">    }</a>
<a class="sourceLine" id="cb23-38" data-line-number="38"></a>
<a class="sourceLine" id="cb23-39" data-line-number="39">    <span class="dt">void</span> <span class="fu">display</span>() {</a>
<a class="sourceLine" id="cb23-40" data-line-number="40">        gl.<span class="fu">glClear</span>(gl.<span class="fu">GL_COLOR_BUFFER_BIT</span>() | gl.<span class="fu">GL_DEPTH_BUFFER_BIT</span>());</a>
<a class="sourceLine" id="cb23-41" data-line-number="41">        gl.<span class="fu">glPushMatrix</span>();</a>
<a class="sourceLine" id="cb23-42" data-line-number="42">        gl.<span class="fu">glRotatef</span>(-<span class="dv">20</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>);</a>
<a class="sourceLine" id="cb23-43" data-line-number="43">        gl.<span class="fu">glRotatef</span>(rot, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>);</a>
<a class="sourceLine" id="cb23-44" data-line-number="44">        glut.<span class="fu">glutSolidTeapot</span>(<span class="fl">0.5</span>);</a>
<a class="sourceLine" id="cb23-45" data-line-number="45">        gl.<span class="fu">glPopMatrix</span>();</a>
<a class="sourceLine" id="cb23-46" data-line-number="46">        glut.<span class="fu">glutSwapBuffers</span>();</a>
<a class="sourceLine" id="cb23-47" data-line-number="47">    }</a>
<a class="sourceLine" id="cb23-48" data-line-number="48"></a>
<a class="sourceLine" id="cb23-49" data-line-number="49">    <span class="dt">void</span> <span class="fu">onIdle</span>() {</a>
<a class="sourceLine" id="cb23-50" data-line-number="50">        rot += <span class="fl">0.1</span>;</a>
<a class="sourceLine" id="cb23-51" data-line-number="51">        glut.<span class="fu">glutPostRedisplay</span>();</a>
<a class="sourceLine" id="cb23-52" data-line-number="52">    }</a>
<a class="sourceLine" id="cb23-53" data-line-number="53"></a>
<a class="sourceLine" id="cb23-54" data-line-number="54">    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span>(<span class="bu">String</span>[] args) {</a>
<a class="sourceLine" id="cb23-55" data-line-number="55">        <span class="kw">try</span> (Scope sc = Scope.<span class="fu">newNativeScope</span>()) {</a>
<a class="sourceLine" id="cb23-56" data-line-number="56">            Pointer&lt;<span class="bu">Integer</span>&gt; argc = sc.<span class="fu">allocate</span>(NativeTypes.<span class="fu">INT32</span>);</a>
<a class="sourceLine" id="cb23-57" data-line-number="57">            argc.<span class="fu">set</span>(<span class="dv">0</span>);</a>
<a class="sourceLine" id="cb23-58" data-line-number="58">            glut.<span class="fu">glutInit</span>(argc, Pointer.<span class="fu">nullPointer</span>());</a>
<a class="sourceLine" id="cb23-59" data-line-number="59">            glut.<span class="fu">glutInitDisplayMode</span>(glut.<span class="fu">GLUT_DOUBLE</span>() | glut.<span class="fu">GLUT_RGBA</span>() | glut.<span class="fu">GLUT_DEPTH</span>());</a>
<a class="sourceLine" id="cb23-60" data-line-number="60">            glut.<span class="fu">glutInitWindowSize</span>(<span class="dv">900</span>, <span class="dv">900</span>);</a>
<a class="sourceLine" id="cb23-61" data-line-number="61">            glut.<span class="fu">glutCreateWindow</span>(sc.<span class="fu">allocateCString</span>(<span class="st">&quot;Hello Panama!&quot;</span>));</a>
<a class="sourceLine" id="cb23-62" data-line-number="62">            Teapot teapot = <span class="kw">new</span> <span class="fu">Teapot</span>(sc);</a>
<a class="sourceLine" id="cb23-63" data-line-number="63">            glut.<span class="fu">glutDisplayFunc</span>(sc.<span class="fu">allocateCallback</span>(teapot::display));</a>
<a class="sourceLine" id="cb23-64" data-line-number="64">            glut.<span class="fu">glutIdleFunc</span>(sc.<span class="fu">allocateCallback</span>(teapot::onIdle));</a>
<a class="sourceLine" id="cb23-65" data-line-number="65">            glut.<span class="fu">glutMainLoop</span>();</a>
<a class="sourceLine" id="cb23-66" data-line-number="66">        }</a>
<a class="sourceLine" id="cb23-67" data-line-number="67">    }</a>
<a class="sourceLine" id="cb23-68" data-line-number="68">}</a></code></pre></div>
<h3 id="running-the-java-code-that-uses-opengl">Running the Java code that uses OpenGL</h3>
<div class="sourceCode" id="cb24"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb24-1" data-line-number="1"></a>
<a class="sourceLine" id="cb24-2" data-line-number="2"><span class="ex">javac</span> -cp opengl.jar Teapot.java</a>
<a class="sourceLine" id="cb24-3" data-line-number="3"></a>
<a class="sourceLine" id="cb24-4" data-line-number="4"><span class="ex">java</span> -cp opengl.jar:. Teapot</a></code></pre></div>
</body>
</html>
